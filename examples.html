


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Examples - Bonsai</title>
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
	<link href="stylesheets/test.css" rel="stylesheet" media="screen" />
    <link href="favicon.ico" rel="icon" type="image/ico" />
      <script src="javascripts/all.js"></script>
	
	<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WVB6MG2');</script>
<!-- End Google Tag Manager -->
	
  </head>

  <body class="examples" data-languages="[]">
	  
	  
	  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WVB6MG2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --> 

  <div id="flex-container">

	<nav id="primary-nav">



	<div id="logo"> <a href="./"><img class="bonsai-logo" src="images/bonsai-logo.svg"></a></div>

	<label for="drop" class="toggle"><img class="menu-ham" src="images/menu.svg"></label>
	<input type="checkbox" id="drop" />

	<ul class="menu">

		<li class="header_menu_item "> <a href="guides/getting-started.html">Getting Started</a></li>

	
		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-1" class="toggle">Guides +</label><a  href="#">Guides</a>			
			<input type="checkbox" id="drop-1"/>
			<ul id="guides">
				<li class=""> <a href="guides/ai-engine-guide.html">A.I. Engine Guide</a>  </li>
				<li class=""> <a href="guides/getting-started.html">Getting Started</a>  </li>
				<li class=""> <a href="guides/inkling-guide.html">Inkling Guide</a>  </li>
			</ul> 
		</li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-2" class="toggle">References +</label><a  href="#">References</a>			
			<input type="checkbox" id="drop-2"/>
			<ul id="references">
				<li class=""> <a href="references/api-reference.html">API</a>  </li>
				<li class=""> <a href="references/cli-reference.html">CLI</a>  </li>
				<li class=""> <a href="references/inkling-reference.html">Inkling</a>  </li>
				<li class=""> <a href="references/library-reference.html">Library</a>  </li>
			</ul> 
		</li>
		
		<li class="header_menu_item selected"> <a href="examples.html">Examples</a></li>

		<li><gcse:search  linktarget="_parent"></gcse:search></li>


	</ul>

</nav>





	<div id="main-wrapper">

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">

        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
      
			 
<ul class="toc-footer">


<li><a href='https://github.com/BonsaiAI/slate'>Contribute to the Docs</a></li>
<li><a href='http://forums.bons.ai/'>Bonsai Forums</a></li>
<li><a href='https://bons.ai/contact-us#contact-page-form'>Contact Us</a></li>
<li><a href='https://bons.ai'>Bonsai Home</a></li>

</ul>
       
        
	   <div class="cc-bottom">
	
	<div class="toc-footer bottom cc-info">

		<a href='https://creativecommons.org/licenses/by-sa/4.0/' class="cc-icon-width" >
			<svg class="cc" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
			viewBox="0 0 70.7 13.4" style="enable-background:new 0 0 70.7 13.4;" xml:space="preserve">

				<g>

				<g>
				<circle class="st0" cx="6.8" cy="6.7" r="6.1"/>
				<path d="M6.7,0c1.9,0,3.5,0.7,4.8,2c0.6,0.6,1.1,1.4,1.4,2.2c0.3,0.8,0.5,1.7,0.5,2.6c0,0.9-0.2,1.8-0.5,2.6
				c-0.3,0.8-0.8,1.5-1.4,2.1c-0.7,0.6-1.4,1.1-2.2,1.5c-0.8,0.3-1.7,0.5-2.6,0.5S5,13.3,4.2,12.9c-0.8-0.3-1.5-0.8-2.2-1.5
				s-1.1-1.4-1.5-2.2S0,7.6,0,6.7C0,5.8,0.2,5,0.5,4.2S1.3,2.6,2,2C3.3,0.7,4.8,0,6.7,0z M6.7,1.2c-1.5,0-2.8,0.5-3.9,1.6
				C2.3,3.4,1.9,4,1.6,4.6C1.4,5.3,1.2,6,1.2,6.7c0,0.7,0.1,1.4,0.4,2.1c0.3,0.7,0.7,1.3,1.2,1.8c0.5,0.5,1.1,0.9,1.8,1.2
				c0.7,0.3,1.4,0.4,2.1,0.4c0.7,0,1.4-0.1,2.1-0.4c0.7-0.3,1.3-0.7,1.8-1.2c1-1,1.6-2.3,1.6-3.9c0-0.7-0.1-1.4-0.4-2.1
				c-0.3-0.7-0.7-1.3-1.2-1.8C9.5,1.8,8.2,1.2,6.7,1.2z M6.6,5.6L5.7,6.1C5.6,5.9,5.5,5.7,5.4,5.6C5.3,5.6,5.1,5.5,5,5.5
				c-0.6,0-0.9,0.4-0.9,1.2c0,0.4,0.1,0.6,0.2,0.9C4.5,7.8,4.7,7.9,5,7.9c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4C6.5,8.1,6.2,8.3,5.9,8.5
				c-0.3,0.2-0.7,0.3-1,0.3c-0.6,0-1.1-0.2-1.5-0.6C3.1,7.9,2.9,7.4,2.9,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6
				C5.7,4.6,6.3,5,6.6,5.6z M10.5,5.6L9.6,6.1C9.5,5.9,9.4,5.7,9.3,5.6C9.1,5.6,9,5.5,8.9,5.5C8.3,5.5,8,5.9,8,6.7
				c0,0.4,0.1,0.6,0.2,0.9c0.2,0.2,0.4,0.3,0.7,0.3c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4c-0.2,0.3-0.4,0.6-0.7,0.8c-0.3,0.2-0.7,0.3-1,0.3
				c-0.6,0-1.1-0.2-1.5-0.6C7,7.9,6.8,7.4,6.8,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6C9.6,4.6,10.2,5,10.5,5.6z"/>
				</g>

				</g>
			</svg>
		</a>
		
		<a href='https://creativecommons.org/licenses/by-sa/4.0/'>Content:
		CC-BY-SA </a>
		
	</div>

</div>

    </div>
	      
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="cart-pole-example">Cart Pole Example</h1>

<p>In this example, we&rsquo;ll walk you through the various statements that are part of the Cart Pole Inkling file. Each statement is followed by an explanation of the statement.</p>

<p>Cart Pole is a classic control problem. <a href="https://gym.openai.com/envs/CartPole-v1">OpenAI Gym</a> describes it as:</p>

<p><em>A pole is attached by an un-actuated joint to a cart, which moves along a frictionless track. The system is controlled by applying a force of +1 or -1 to the cart. The pendulum starts upright, and the goal is to prevent it from falling over. A reward of +1 is provided for every timestep that the pole remains upright. The episode ends when the pole is more than 15 degrees from vertical, or the cart moves more than 2.4 units from the center.</em></p>

<h2 id="schema-gamestate-action-and-cartpoleconfig">Schema: <code class="prettyprint">GameState</code>, <code class="prettyprint">Action</code>, and <code class="prettyprint">CartPoleConfig</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">GameState</span>
  <span class="kr">Float32</span> <span class="nx">position</span><span class="p">,</span>
  <span class="kr">Float32</span> <span class="nx">velocity</span><span class="p">,</span>
  <span class="kr">Float32</span> <span class="nx">angle</span><span class="p">,</span>
  <span class="kr">Float32</span> <span class="nx">rotation</span>
<span class="k">end</span>
</code></pre>
<p>The schema <code class="prettyprint">GameState</code> names four records — <code class="prettyprint">position</code>, <code class="prettyprint">velocity</code>, <code class="prettyprint">angle</code>, and <code class="prettyprint">rotation</code> — and assigns a type to them. This information is input from the simulation.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">Action</span>
  <span class="kr">Int8</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">}</span> <span class="k">action</span>
<span class="k">end</span>
</code></pre>
<p>The schema <code class="prettyprint">Action</code> names a record — <code class="prettyprint">action</code> —  and assigns it a constrained type.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">CartPoleConfig</span>
  <span class="kr">Int8</span> <span class="nx">episode_length</span><span class="p">,</span>
  <span class="kr">Int8</span> <span class="nx">num_episodes</span><span class="p">,</span>
  <span class="kr">UInt8</span> <span class="nx">deque_size</span>
<span class="k">end</span>
</code></pre>
<p>The schema <code class="prettyprint">CartPoleConfig</code> names three records — <code class="prettyprint">episode_length</code>, <code class="prettyprint">num_episodes</code>, and <code class="prettyprint">deque_size</code> — and assigns each of them a type.</p>

<h2 id="concept-balance">Concept: <code class="prettyprint">balance</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">concept</span> <span class="nx">balance</span>
  <span class="k">is</span> <span class="nx">classifier</span>
  <span class="k">predicts</span> <span class="nx">Action</span>
  <span class="k">follows</span> <span class="kr">input</span><span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
  <span class="k">feeds</span> <span class="kr">output</span>
<span class="k">end</span>
</code></pre>
<p>The concept is named <code class="prettyprint">balance</code>, and it takes input from the simulator. That input is the records in the schema <code class="prettyprint">GameState</code>. The balance concept outputs the move the AI should make in the simulator. This output is the record in the <code class="prettyprint">Action</code> schema.</p>

<h2 id="curriculum-balance_curriculum">Curriculum: <code class="prettyprint">balance_curriculum</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">simulator</span> <span class="nx">cartpole_simulator</span><span class="p">(</span><span class="nx">CartPoleConfig</span><span class="p">)</span>
  <span class="k">state</span> <span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">curriculum</span> <span class="nx">balance_curriculum</span>
  <span class="k">train</span> <span class="nx">balance</span>
  <span class="k">with</span> <span class="k">simulator</span> <span class="nx">cartpole_simulator</span>
  <span class="k">objective</span> <span class="nx">up_time</span>
  <span class="k">lesson</span> <span class="nx">balancing</span>
    <span class="k">configure</span>
      <span class="k">constrain</span> <span class="nx">episode_length</span> <span class="k">with</span> <span class="kr">Int8</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
      <span class="k">constrain</span> <span class="nx">num_episodes</span> <span class="k">with</span> <span class="kr">Int8</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
      <span class="k">constrain</span> <span class="nx">deque_size</span> <span class="k">with</span> <span class="kr">UInt8</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">until</span>
      <span class="k">maximize</span> <span class="nx">up_time</span>
<span class="k">end</span>
</code></pre>
<ul>
<li>The curriculum&rsquo;s name is balance_curriculum. It trains the balance concept with a simulator, specifically the cartpole_simulator.</li>
<li>The cartpole_simulator gets information from two schemas. The first schema, CartPoleConfig, specifies the schema for configuration of the simulation. The second schema contains the state of the simulator that is sent to the lesson.</li>
<li>The objective for this curriculum is up_time. The objective measures how long the pole stays upright.</li>
<li>This curriculum contains one lesson, called balancing. It configures the simulation, by setting a number of constraints for the state of the simulator.</li>
<li>The lesson trains until the AI has maximized the objective.</li>
</ul>

          <h1 id="energyplus-example">EnergyPlus Example</h1>

<p>The full source code for this example can be <a href="https://github.com/BonsaiAI/energyplus-sample">found on GitHub</a> so you can run it yourself on the Bonsai Platform.</p>

<p>In this example, we&rsquo;ll walk you through the various statements that are part of a sample implementation of <a href="https://energyplus.net/">EnergyPlus</a> on the Bonsai Platform, including the simulator and the Inkling files. This is a real-world example of how to use the Bonsai Platform for HVAC control using BCVTB and EnergyPlus.</p>

<p>While this BRAIN is training, the Bonsai AI Engine launches the EnergyPlus simulator in the background for every episode. The <em>energyplus_simulator.py</em> then drives the simulator forward a step at a time until it finishes the episode and then relaunches it for the next episode, driving the actions into it and sending state results back to the Bonsai AI Engine.</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="schema">Schema</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">SimState</span>
    <span class="kr">Int32</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span> <span class="nx">SolarIrradiation</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">SimState</code> schema defines the dictionary returned from the Python simulation&rsquo;s advance method to the BRAIN.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">SimAction</span>
    <span class="kr">Int32</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span> <span class="nx">shade</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">SimAction</code> schema defines the <code class="prettyprint">action</code> dictionary passed as a parameter to the <code class="prettyprint">advance</code> method of the Python simulator. For example: <code class="prettyprint">shade</code> == night, off, day.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">SimConfig</span>
    <span class="kr">Int32</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="nx">unused</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">SimConfig</code> schema in this case is not used (but is still required to be defined in Inkling) but it would define the dictionary passed as a parameter to the <code class="prettyprint">set_properties</code> method of the Python simulator.</p>

<h6 id="concept">Concept</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">concept</span> <span class="nx">my_concept</span> <span class="k">is</span> <span class="nx">classifier</span>
   <span class="k">predicts</span> <span class="p">(</span><span class="nx">SimAction</span><span class="p">)</span>
   <span class="k">follows</span> <span class="kr">input</span><span class="p">(</span><span class="nx">SimState</span><span class="p">)</span>
   <span class="k">feeds</span> <span class="kr">output</span>
<span class="k">end</span>
</code></pre>
<p>This concept is named <code class="prettyprint">my_concept</code> which predicts a <code class="prettyprint">SimAction</code> given a <code class="prettyprint">SimState</code>.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">simulator</span> <span class="nx">energyplus_simulator</span><span class="p">(</span><span class="nx">SimConfig</span><span class="p">)</span>
    <span class="k">action</span> <span class="p">(</span><span class="nx">SimAction</span><span class="p">)</span>
    <span class="k">state</span> <span class="p">(</span><span class="nx">SimState</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>This simulator is the training source for teaching <code class="prettyprint">my_concept</code>. The Python simulator identifies itself as &lsquo;energyplus_simulator&rsquo; when it connects with the AI Engine. The following statements bind the above schemas to this simulator. To define the training relationship between the simulator and the concept we must begin by defining the simulator. <code class="prettyprint">energyplus_simulator</code> expects an action defined in the <code class="prettyprint">SimAction</code> schema as input and replies with a state defined in the <code class="prettyprint">SimState</code> schema as output.</p>

<h6 id="curriculum">Curriculum</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">curriculum</span> <span class="nx">my_curriculum</span>
    <span class="k">train</span> <span class="nx">my_concept</span>
    <span class="k">with</span> <span class="k">simulator</span> <span class="nx">energyplus_simulator</span>
    <span class="k">objective</span> <span class="nx">reward_function</span>
        <span class="k">lesson</span> <span class="nx">my_first_lesson</span>
            <span class="k">configure</span>
                <span class="k">constrain</span> <span class="nx">unused</span> <span class="k">with</span> <span class="kr">Int32</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
            <span class="k">until</span>
                <span class="k">maximize</span> <span class="nx">reward_function</span>
<span class="k">end</span>
</code></pre>
<p>The cirriculum <code class="prettyprint">my_curriculum</code> trains <code class="prettyprint">my_concept</code> using <code class="prettyprint">energyplus_simulator</code>. The BRAIN that runs this Inkling code will try to maximize the value returned from <code class="prettyprint">reward_function</code> until you stop training. <code class="prettyprint">reward_function</code> is a method in the Python simulator.</p>

<p>This curriculum contains one lesson, called <code class="prettyprint">my_first_lesson</code>. It configures the simulation, by setting a number of constraints for the state of the simulator.</p>

<h2 id="simulator-file">Simulator File</h2>
<pre class="highlight python tab-python"><code><span class="c"># Excerpt of simulator class from the energyplus_simulator.py file</span>

<span class="k">class</span> <span class="nc">EnergyPlusSimulator</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ePlus85Actuator</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span><span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">shade</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""This method is called when training is started."""</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: start"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: stop"</span><span class="p">)</span>

        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grapher</span><span class="p">()</span>
        <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">"graph.html"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readFromPtolemyClient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">readFromClient</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c"># 'TOut': self.model.fromClient[0],</span>
                <span class="c"># 'TZone': self.model.fromClient[1],</span>
                <span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span>
                <span class="c"># 'FractionShadingOn': self.model.fromClient[3]</span>
                <span class="p">}</span>

            <span class="c"># save the client input in our graph</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c"># scale some of the values for readability</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">/=</span> <span class="mf">100.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exitFlag</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">restartPtolemyServer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># set some default values for get_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># self.clientState = {'TOut': 0.,</span>
        <span class="c">#                     'TZone': 0.,</span>
        <span class="c">#                     'SolarIrradiation': 0.,</span>
        <span class="c">#                     'FractionShadingOn': 0. }</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span><span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c"># close the old connections if they're still open</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># start a new episode</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: starting PtolemyServer"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">PtolemyServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">waitForClient</span><span class="p">()</span>
            <span class="c"># get initial state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readFromPtolemyClient</span><span class="p">()</span>

        <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: error on restart:"</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Called by the AI Engine to reset simulator state in between training
           and test passes.
        """</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: reset"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: advance "</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
        <span class="s">"""Advance the simulation forward one tick. actions contains a
           dictionary of key values as defined by this simulator's action
           schema in Inkling.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">=</span> <span class="n">actions</span><span class="p">[</span><span class="s">'shade'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.</span>  <span class="c"># Int32[0..1]</span>

    <span class="k">def</span> <span class="nf">set_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: set_properties"</span><span class="p">)</span>
        <span class="s">"""This method is called before training is started
           or on the frame after is_terminal=True to set
           configuration properties in this simulation. See
           the configure clause of the lesson statement in
           this simulator's accompanying curriculums.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restartPtolemyServer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Returns a named tuple of state and is_terminal. state is a
           dictionary matching the state schema as defined in Inkling.
           is_terminal is only true when the simulator is in a "game over"
           state.
        """</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: get_state: terminal:"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restartPtolemyServer</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">writeToClient</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">shade</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readFromPtolemyClient</span><span class="p">()</span>

        <span class="c"># you like graphs? WE HAVE GRAPHS. SO MANY GRAPHS.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grapher</span><span class="p">()</span>
            <span class="n">write_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

            <span class="c"># clear old data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>

        <span class="k">return</span> <span class="n">SimState</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clientState</span><span class="p">,</span> <span class="n">is_terminal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reward_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: reward_function"</span><span class="p">)</span>
        <span class="c"># largest reward is best reward (maximize)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c"># SolarIrradiation === Shades down === good</span>
            <span class="c"># TOut = self.model.fromClient[0]</span>
            <span class="n">SolarIrradiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.</span>

            <span class="c"># sun is down</span>
            <span class="k">if</span> <span class="n">SolarIrradiation</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># shades on</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># shade off</span>

            <span class="c"># sun is out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># shades on</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># shades off</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator reward:"</span><span class="p">,</span> <span class="n">reward</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reward</span>
</code></pre>
<p>The full simulator file <em>energyplus_simulator.py</em> for this example is with the rest of the <a href="https://github.com/BonsaiAI/energyplus-sample">energyplus-sample code</a> on GitHub.</p>

<p>This is a Python simulator for integrating the EnergyPlus simulator into the Bonsai AI Engine. This <em>energyplus_simulator.py</em> file repeatedly runs the EnergyPlus simulator in the background with new actions sent from the Bonsai AI Engine by passing the state from EnergyPlus to the backend, and the action from the backend back to EnergyPlus.</p>

<p>For more information on the funtions inside of this simulator class and how to impliment them see the <a href="http://docs.bons.ai/references/library-reference.html">Library Reference</a>.</p>

          <h1 id="find-the-center-example">Find the Center Example</h1>

<p>In this example, we&rsquo;ll walk you through the various statements that are part of the <em>Find the Center</em> game, including the simulator file and the Inkling file. This is a very basic example of Inkling and how to connect to a simulator.</p>

<p><em>Find the Center</em> is a simple game where the AI seeks the average value between two numbers. In this game, the AI begins at a random value of 0, 1, or 2. The AI then can move to a lower number by outputing -1, a higher number by outputing +1, or staying on the same number by outputing 0. The goal of <em>Find the Center</em> is to remain in the center of 0 and 2 (the number 1).</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="schema">Schema</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">GameState</span>
    <span class="kr">Int32</span> <span class="nx">value</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">GameState</code> schema has one field, <code class="prettyprint">value</code>, with type <code class="prettyprint">Int32</code>.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">PlayerMove</span>
    <span class="kr">Int32</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span> <span class="nx">delta</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">PlayerMove</code> schema has one field, <code class="prettyprint">delta</code>, with type <code class="prettyprint">Int32</code>. The <code class="prettyprint">Int32</code> type is constrained to three possible values: -1, 0, and 1.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">SimConfig</span>
    <span class="kr">Int32</span> <span class="nx">dummy</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">SimConfig</code> schema has one field, <code class="prettyprint">dummy</code>, because there is no configuration needed in this particular example.</p>

<h6 id="concept">Concept</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">concept</span> <span class="nx">find_the_center</span>
    <span class="k">is</span> <span class="nx">classifier</span>
    <span class="k">predicts</span> <span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span>
    <span class="k">follows</span> <span class="kr">input</span><span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
    <span class="k">feeds</span> <span class="kr">output</span>
<span class="k">end</span>
</code></pre>
<p>This concept is named <code class="prettyprint">find_the_center</code>. <code class="prettyprint">find_the_center</code> expects input about the state of the game (defined by the <code class="prettyprint">GameState</code> schema) and replies with output defined by the <code class="prettyprint">PlayerMove</code> schema. This is the AI&rsquo;s next move in the simulation.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">simulator</span> <span class="nx">find_the_center_sim</span><span class="p">(</span><span class="nx">SimConfig</span><span class="p">)</span>
    <span class="k">action</span> <span class="p">(</span><span class="nx">PlayerMove</span><span class="p">)</span>
    <span class="k">state</span> <span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">simulator</code> is called <code class="prettyprint">find_the_center_sim</code> (shown in #simulator-file) and takes the schema input of <code class="prettyprint">SimConfig</code> (even though it isn&rsquo;t configuring anything, it&rsquo;s required by the simulator). The <code class="prettyprint">find_the_center</code> concept will be trained using the <code class="prettyprint">find_the_center_sim</code> simulator. To define the training relationship between the simulator and the concept we must begin by defining the simulator. <code class="prettyprint">find_the_center_sim</code> expects an action defined in the <code class="prettyprint">PlayerMove</code> schema as input and replies with a state defined in the <code class="prettyprint">GameState</code> schema as output.</p>

<h6 id="curriculum">Curriculum</h6>
<pre class="highlight inkling tab-inkling"><code><span class="k">curriculum</span> <span class="nx">find_the_center_curriculum</span>
    <span class="k">train</span> <span class="nx">find_the_center</span>
    <span class="k">with</span> <span class="k">simulator</span> <span class="nx">find_the_center_sim</span>
    <span class="k">objective</span> <span class="nx">time_at_goal</span>
        <span class="k">lesson</span> <span class="nx">seek_center</span>
            <span class="k">configure</span>
                <span class="k">constrain</span> <span class="nx">dummy</span> <span class="k">with</span> <span class="kr">Int32</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
            <span class="k">until</span>
                <span class="k">maximize</span> <span class="nx">time_at_goal</span>
<span class="k">end</span>
</code></pre>
<p>The curriculum is named <code class="prettyprint">find_the_center_curriculum</code>, and it trains the <code class="prettyprint">find_the_center</code> concept using the <code class="prettyprint">find_the_center_sim</code>. This curriculum contains one lesson, called <code class="prettyprint">seek_center</code>. It configures the simulation, by setting a number of constraints for the state of the simulator.</p>

<p>The lesson trains until the AI has maximized the objective <code class="prettyprint">time_at_goal</code>.</p>

<h2 id="simulator-file">Simulator File</h2>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">bonsai</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">bonsai.simulator</span> <span class="kn">import</span> <span class="n">SimState</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="s">""" If you would like to debug your code add this back in.
def debug(*args):
    print(*args, file=sys.stderr)
"""</span>


<span class="k">class</span> <span class="nc">BasicSimulator</span><span class="p">(</span><span class="n">bonsai</span><span class="o">.</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="s">""" A basic simulator class that takes in a move from the inkling file,
    and returns the state as a result of that move.
    """</span>

    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">BasicSimulator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">min</span>

    <span class="k">def</span> <span class="nf">get_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Restarts the simulation if the AI moved out of bounds.
        """</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="nb">min</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span><span class="p">):</span>
            <span class="c"># (self.value == self.goal and self.old_value == self.goal)):</span>

            <span class="c"># debug("terminal")</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Start the episode by initializing value to a random number
        between the min and max.
        """</span>
        <span class="c"># debug("start")</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Stop is called after a training session is complete.
        This simple game requires no cleanup after training.
        """</span>
        <span class="c"># debug("stop")</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Reset is called to reset simulator state before the next training session.
        """</span>
        <span class="c"># debug("reset")</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">advance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="s">""" Function to make a move based on output from the BRAIN as
        defined in the Inkling file.
        """</span>
        <span class="c"># debug("advance", actions["delta"])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">actions</span><span class="p">[</span><span class="s">"delta"</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Gets the state of the simulator, whether it be a valid value or
        terminal ("game over") state.
        """</span>
        <span class="c"># debug("get_state")</span>
        <span class="c"># debug("state", self.value)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="n">SimState</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="s">"value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">},</span>
                        <span class="n">is_terminal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_terminal</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">time_at_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" Function to return how long the simulation has maintained the goal.
        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">base_args</span> <span class="o">=</span> <span class="n">bonsai</span><span class="o">.</span><span class="n">parse_base_arguments</span><span class="p">()</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">BasicSimulator</span><span class="p">()</span>
    <span class="n">bonsai</span><span class="o">.</span><span class="n">run_with_url</span><span class="p">(</span><span class="s">'find_the_center_sim'</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span>
                        <span class="n">base_args</span><span class="o">.</span><span class="n">brain_url</span><span class="p">,</span> <span class="n">base_args</span><span class="o">.</span><span class="n">access_key</span><span class="p">)</span>
</code></pre>
<p>This is a Basic simulator for learning the simulator interface. In this case it is used to find the center between two numbers, 0 and 2. The goal, as outlined in the Inkling file, is to reach 1. The moves that the simulator is able to make are sent from the Inkling file to the simulator and the state of the simulator is sent back to Inkling.</p>

          <h1 id="mountain-car-example">Mountain Car Example</h1>

<p>We&rsquo;ve used pieces of code from this example in several places, but here we&rsquo;ll walk you through all the various statements that are part of the Mountain Car Inkling file. Each statement is followed by an explanation of the statement.</p>

<p>Mountain car is a classic control problem. <a href="https://gym.openai.com/envs/MountainCar-v0">OpenAI Gym</a> describes it as:</p>

<p><em>A car is on a one-dimensional track, positioned between two &ldquo;mountains&rdquo;. The goal is to drive up the mountain on the right; however, the car&rsquo;s engine is not strong enough to scale the mountain in a single pass. Therefore, the only way to succeed is to drive back and forth to build up momentum.</em></p>

<h2 id="schema-gamestate-action-mountaincarconfig">Schema: <code class="prettyprint">GameState</code>, <code class="prettyprint">Action</code>, <code class="prettyprint">MountainCarConfig</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">GameState</span>
   <span class="kr">Float32</span> <span class="nx">x_position</span><span class="p">,</span>
   <span class="kr">Float32</span> <span class="nx">y_velocity</span>
<span class="k">end</span>
</code></pre>
<p>The GameState schema names two records — <code class="prettyprint">x_position</code> and <code class="prettyprint">y_position</code> — and assigns a type to them.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">Action</span>
  <span class="kr">Int8</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="k">action</span>
<span class="k">end</span>
</code></pre>
<p>The Action schema names a single record — <code class="prettyprint">action</code> — and assigns a constrained type to it.</p>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">MountainCarConfig</span>
  <span class="kr">Int8</span> <span class="nx">episode_legnth</span><span class="p">,</span>
  <span class="kr">Int8</span> <span class="nx">num_episodes</span><span class="p">,</span>
  <span class="kr">UInt8</span> <span class="nx">deque_size</span>
<span class="k">end</span>
</code></pre>
<p>The <code class="prettyprint">MountainCarConfig</code> schema names three records — <code class="prettyprint">episode_length</code>, <code class="prettyprint">num_episodes</code>, and <code class="prettyprint">deque_size</code> — and assigns types to them.</p>

<h2 id="concept-high_score">Concept <code class="prettyprint">high_score</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">concept</span> <span class="nx">high_score</span>
  <span class="k">is</span> <span class="nx">classifier</span>
  <span class="k">predicts</span> <span class="nx">Action</span>
  <span class="k">follows</span> <span class="kr">input</span><span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
  <span class="k">feeds</span> <span class="kr">output</span>
<span class="k">end</span>
</code></pre>
<p>The concept is named <code class="prettyprint">high_score</code>, and it takes input from the simulator about the state of the game (<code class="prettyprint">GameState</code> schema). It outputs to the <code class="prettyprint">Action</code> schema. This is the AI&rsquo;s next move in the game.</p>

<h2 id="curriculum-high_score_curriculum">Curriculum: <code class="prettyprint">high_score_curriculum</code></h2>
<pre class="highlight inkling tab-inkling"><code><span class="k">simulator</span> <span class="nx">mountaincar_simulator</span><span class="p">(</span><span class="nx">MountainCarConfig</span><span class="p">)</span>
  <span class="k">state</span>  <span class="p">(</span><span class="nx">GameState</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">curriculum</span> <span class="nx">high_score_curriculum</span>
  <span class="k">train</span> <span class="nx">high_score</span>
  <span class="k">with</span> <span class="k">simulator</span> <span class="nx">mountaincar_simulator</span>
  <span class="k">objective</span> <span class="nx">score</span>
  <span class="k">lesson</span> <span class="nx">get_high_score</span>
    <span class="k">configure</span>
      <span class="k">constrain</span> <span class="nx">episode_length</span> <span class="k">with</span> <span class="kr">Int8</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span>
      <span class="k">constrain</span> <span class="nx">num_episodes</span> <span class="k">with</span> <span class="kr">Int8</span><span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">},</span>
      <span class="k">constrain</span> <span class="nx">deque_size</span> <span class="k">with</span> <span class="kr">UInt8</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">until</span>
      <span class="k">maximize</span> <span class="nx">score</span>
<span class="k">end</span>
</code></pre>
<ul>
<li>The curriculum is named high_score_curriculum, and it trains the high_score concept using the mountaincar_simulator.</li>
<li>The mountain_car simulator gets information from two schemas. The first (<code class="prettyprint">MountainCarConfig</code>) specifies the schema for configuration of the simulation. The second schema contains the state of the simulator that is sent to the lesson.</li>
<li>This curriculum contains one lesson, called <code class="prettyprint">get_high_score</code>. It configures the simulation, by setting a number of constraints for the state of the simulator.</li>
<li>The lesson trains until the AI has maximized the objective.</li>
</ul>

      </div>
      <div class="dark-box">
      </div>
    </div>

    </div>

  </div>

  </body>
</html>
