


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Examples - Bonsai</title>
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #ffffff;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #ffc33e;
}
.highlight .cp {
  color: #ffc33e;
}
.highlight .nt {
  color: #ffc33e;
}
.highlight .o, .highlight .ow {
  color: #ffffff;
}
.highlight .p, .highlight .pi {
  color: #ffffff;
}
.highlight .gi {
  color: #ffffff;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #51beff;
}
.highlight .kc {
  color: #4af065;
}
.highlight .kt {
  color: #4af065;
}
.highlight .kd {
  color: #4af065;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #ffffff;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #ffc33e;
}
.highlight .nc {
  color: #ffc33e;
}
.highlight .no {
  color: #ffc33e;
}
.highlight .nx {
  color: #4af065;
}
.highlight .nb, .highlight .bp {
  color: #4af065;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #ffffff;
}
.highlight .ss {
  color: #ffffff;
}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic"]  }});</script>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
	  <link href="stylesheets/test.css" rel="stylesheet" media="screen" />
    <link href="favicon.ico" rel="icon" type="image/ico" />
      <script src="javascripts/all.js"></script>
      <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WVB6MG2');</script>
<!-- End Google Tag Manager -->
      <!-- start Mixpanel -->
<script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
mixpanel.init("91fbf7b68fb2356f91916026f221ddd5", {
    loaded: function(mixpanel) {
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        distinct_id = getParameterByName('refUserId');
        if (distinct_id) {
          mixpanel.identify(distinct_id);
        }
    }
});</script>
<!-- end Mixpanel -->

  </head>

  <body class="examples" data-languages="[&quot;python&quot;,&quot;cpp&quot;]">


	  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WVB6MG2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --> 

  <div id="flex-container">

	<nav id="primary-nav">



	<div id="logo"> <a href="./"><img class="bonsai-logo" src="images/bonsai-logo.svg"></a></div>

	<label for="drop" class="toggle"><img class="menu-ham" src="images/menu.svg"></label>
	<input type="checkbox" id="drop" />

	<ul class="menu">

		<li class="header_menu_item "> <a href="guides/getting-started.html">Quick Start</a></li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-1" class="toggle">Tutorials +</label><a  href="#">Tutorials</a>
			<input type="checkbox" id="drop-1"/>
			<ul id="tutorials">
				<li class=""> <a href="guides/cli-install-guide.html">Install the CLI</a>  </li>
				<li class=""> <a href="guides/local-dev-guide.html">Use the CLI for Training</a>  </li>
				<li class=""> <a href="guides/sdk-install-guide.html">Install the SDK</a>  </li>
				<li class=""> <a href="tutorials/tutorial1.html">Running Simulations and Writing Inkling</a>  </li>
				<li class=""> <a href="tutorials/simulink.html">Train a Simulink Model with Bonsai</a>  </li>
				<li class=""> <a href="guides/jupyter-api-guide.html">Use Bonsai's API with Jupyter</a>  </li>
			</ul>
		</li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-2" class="toggle">Guides +</label><a  href="#">Guides</a>
			<input type="checkbox" id="drop-2"/>
			<ul id="guides">
				<li class=""> <a href="guides/simulation-guide.html">Learn About Simulation Requirements</a>  </li>
				<li class=""> <a href="guides/inkling2-guide.html">Learn the Inkling Language</a>  </li>
				<li class=""> <a href="guides/machine-teaching.html">Programming Machine Teaching</a>  </li>
				<li class=""> <a href="guides/ai-engine-guide.html">Understand AI Engine Components</a>  </li>
				<li class=""> <a href="guides/web-graphs-guide.html">Understand BRAIN Graphs</a>  </li>
				<li class=""> <a href="guides/sim-scale-guide.html">Scale Simulation runs with Azure Batch</a>  </li>
			</ul>
		</li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-3" class="toggle">References +</label><a  href="#">References</a>
			<input type="checkbox" id="drop-3"/>
			<ul id="references">
				<li class=""> <a href="references/api-reference.html">API Reference</a>  </li>
				<li class=""> <a href="references/cli-reference.html">CLI Reference</a>  </li>
				<li class=""> <a href="references/inkling2-reference.html">Inkling Reference</a>  </li>
				<li class=""> <a href="references/simulator-reference.html">Simulator Reference</a>
				<li class=""> <a href="references/library-reference.html">Python Library</a>  </li>
				<li class=""> <a href="references/cpp-library-reference.html">C++ Library</a>  </li>

			</ul>
		</li>

		<li class="header_menu_item selected"> <a href="examples.html">Examples</a></li>

		<li>
			<input type="search" id="docs-search" placeholder="Search Bonsai Docs">
		</li>


	</ul>

</nav>


	<div id="main-wrapper">

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">

        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="cpp">cpp</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div class="page-title">Examples</div>
      <div id="toc">
      </div>

			 
<ul class="toc-footer">

<li><a href='https://bons.ai'>Bonsai Home</a></li>
<li><a href='https://beta.bons.ai'>BRAIN Dashboard</a></li>
<li><a href='https://github.com/BonsaiAI/slate'>Contribute to the Docs</a></li>
<li><a href='https://bons.ai/get-started'>Apply for Bonsai Platform Preview</a></li>
<li><a href="/releases.html">Product Release Notes</a></li>
<li><a href="/system-reqs.html">Official System Requirements</a></li>
<li><a href='https://bons.ai/contact-us#contact-page-form'>Contact Us</a></li>

</ul>


	   <div class="cc-bottom">
	
	<div class="toc-footer bottom cc-info">

		<a href='https://creativecommons.org/licenses/by-sa/4.0/' class="cc-icon-width" >
			<svg class="cc" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
			viewBox="0 0 70.7 13.4" style="enable-background:new 0 0 70.7 13.4;" xml:space="preserve">

				<g>

				<g>
				<circle class="st0" cx="6.8" cy="6.7" r="6.1"/>
				<path d="M6.7,0c1.9,0,3.5,0.7,4.8,2c0.6,0.6,1.1,1.4,1.4,2.2c0.3,0.8,0.5,1.7,0.5,2.6c0,0.9-0.2,1.8-0.5,2.6
				c-0.3,0.8-0.8,1.5-1.4,2.1c-0.7,0.6-1.4,1.1-2.2,1.5c-0.8,0.3-1.7,0.5-2.6,0.5S5,13.3,4.2,12.9c-0.8-0.3-1.5-0.8-2.2-1.5
				s-1.1-1.4-1.5-2.2S0,7.6,0,6.7C0,5.8,0.2,5,0.5,4.2S1.3,2.6,2,2C3.3,0.7,4.8,0,6.7,0z M6.7,1.2c-1.5,0-2.8,0.5-3.9,1.6
				C2.3,3.4,1.9,4,1.6,4.6C1.4,5.3,1.2,6,1.2,6.7c0,0.7,0.1,1.4,0.4,2.1c0.3,0.7,0.7,1.3,1.2,1.8c0.5,0.5,1.1,0.9,1.8,1.2
				c0.7,0.3,1.4,0.4,2.1,0.4c0.7,0,1.4-0.1,2.1-0.4c0.7-0.3,1.3-0.7,1.8-1.2c1-1,1.6-2.3,1.6-3.9c0-0.7-0.1-1.4-0.4-2.1
				c-0.3-0.7-0.7-1.3-1.2-1.8C9.5,1.8,8.2,1.2,6.7,1.2z M6.6,5.6L5.7,6.1C5.6,5.9,5.5,5.7,5.4,5.6C5.3,5.6,5.1,5.5,5,5.5
				c-0.6,0-0.9,0.4-0.9,1.2c0,0.4,0.1,0.6,0.2,0.9C4.5,7.8,4.7,7.9,5,7.9c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4C6.5,8.1,6.2,8.3,5.9,8.5
				c-0.3,0.2-0.7,0.3-1,0.3c-0.6,0-1.1-0.2-1.5-0.6C3.1,7.9,2.9,7.4,2.9,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6
				C5.7,4.6,6.3,5,6.6,5.6z M10.5,5.6L9.6,6.1C9.5,5.9,9.4,5.7,9.3,5.6C9.1,5.6,9,5.5,8.9,5.5C8.3,5.5,8,5.9,8,6.7
				c0,0.4,0.1,0.6,0.2,0.9c0.2,0.2,0.4,0.3,0.7,0.3c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4c-0.2,0.3-0.4,0.6-0.7,0.8c-0.3,0.2-0.7,0.3-1,0.3
				c-0.6,0-1.1-0.2-1.5-0.6C7,7.9,6.8,7.4,6.8,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6C9.6,4.6,10.2,5,10.5,5.6z"/>
				</g>

				</g>
			</svg>
		</a>
		
		<a href='https://creativecommons.org/licenses/by-sa/4.0/'>Content:
		CC-BY-SA </a>
		
	</div>

</div>

    </div>

    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="examples-overview">Examples Overview</h1>

<p>This page contains working examples of Inkling code in conjunction with python and C++ simulator files. All of these examples and the libraries that accompany them can be found within <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples">BonsaiAI&rsquo;s SDK GitHub repo</a> and are also linked for each example.</p>

<p>All of the <strong>Python</strong>, <strong>OpenAI Gym</strong>, and <strong>EnergyPlus</strong> examples can be trained in the cloud with managed simulators. A full list of supported Docker containers for remotely managed simulators can be found in the <a href="references/cli-reference.html#bproj-file">Project File Reference</a>.</p>

<p>If you have any suggestions of examples you&rsquo;d like to see us implement please <a href="https://bons.ai/contact-us#contact-page-form">contact the support team</a>.</p>

<h3 id="custom-simulator-examples">Custom Simulator Examples</h3>

<ul>
<li><strong>Basic Python/C++ Simulation</strong>: A project called <em>Find the Center</em> which walks you through how to create a simple Inkling file that connects to a basic Python or C++ simulator.</li>
<li><strong>Stellar Cartpole</strong>: A stand-alone version of Cartpole using the machine teaching pattern of STAR.</li>
<li><strong>SimPy Elevator Simulation</strong>: A basic example of how to use SimPy to simulate a scenario. This one is an elevator dropping people off on 3 floors.</li>
<li><strong>Tic-tac-toe</strong>: A simple implementation of pixel manipulation through the Image.Gray type for a tic-tac-toe board. Also showcases the use of an algorithm hint.</li>
</ul>

<h3 id="openai-gym-examples">OpenAI Gym Examples</h3>

<ul>
<li><strong>Mountain Car</strong>: A simple control problem where a car must build up enough momentum to climb a hill.</li>
<li><strong>Cartpole</strong>: A simple control problem where a cart must make a simple move to keep a pole balanced on top.</li>
<li><strong>Predictor Class Cartpole</strong>: Using the same Inkling as original Cartpole, but using the Predictor Class to obtain simulation predictions via Python script.</li>
<li><strong>Event Driven Cartpole</strong>: Using the same Inkling as original Cartpole, but using the Event class to drive the simulation.</li>
</ul>

<h3 id="real-world-example">Real World Example</h3>

<ul>
<li><strong>HVAC with EnergyPlus</strong>: An example of climate control machine teaching using EnergyPlus and BCVTB for simulation. </li>
</ul>

<h3 id="simulink-example">Simulink Example</h3>

<ul>
<li><strong>Simulink Househeat</strong>: The Simulink version of an HVAC system taking into account the outdoor environment, the thermal characteristics of the house, and the house heating system.</li>
</ul>

          <h1 id="basic-python-c-simulation">Basic Python/C++ Simulation</h1>

<blockquote>
<p><img src="images/find-the-center.png" alt="Find the Center Diagram" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/blob/master/samples/find-the-center-py"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally.</p>

<p>In this example, we&rsquo;ll explore the statements that are part of the <em>Find the Center</em> game, including options for either a Python or C++ simulator file and the Inkling file. This is a basic example of Inkling and how to connect to a custom simulator. It demonstrates the differences between using <code class="prettyprint">libbonsai</code> (C++) and the <code class="prettyprint">bonsai-ai</code> (Python) libraries.</p>

<p><em>Find the Center</em> is a simple game where the AI seeks the average value between two numbers. In this game, the AI begins at a random value of 0, 1, or 2. The AI then can move to a lower number by outputting -1, a higher number by outputting +1, or staying on the same number by outputting 0. The goal of <em>Find the Center</em> is to remain in the center of 0 and 2 (the number 1).</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">GameState</span> <span class="p">{</span>
    <span class="nx">value</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">GameState</code> type has one field, <code class="prettyprint">value</code>, with type <code class="prettyprint">Number.Int8</code>.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">PlayerMove</span> <span class="p">{</span>
    <span class="nx">delta</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="nx">Dec</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">Stay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Inc</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">PlayerMove</code> type has one field, <code class="prettyprint">delta</code>, with three possible values: -1, 0, and 1.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">GameState</span><span class="p">):</span> <span class="nx">PlayerMove</span> <span class="p">{</span>

    <span class="k">concept</span> <span class="nx">find_the_center</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">PlayerMove</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">find_the_center_sim</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">output</span> <span class="nx">find_the_center</span>
<span class="p">}</span>
</code></pre>
<p>The concept is named <code class="prettyprint">find_the_center</code>, and it expects input about the state of the game (of type <code class="prettyprint">GameState</code>) and replies with output of type <code class="prettyprint">PlayerMove</code>. This is the AI&rsquo;s next move in the simulation.</p>

<p>The curriculum trains the concept using the <code class="prettyprint">find_the_center_sim</code> simulator. It defines no lessons, so a default lesson is assumed.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">find_the_center_sim</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">PlayerMove</span><span class="p">):</span> <span class="nx">GameState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">simulator</code> is called <code class="prettyprint">find_the_center_sim</code> (shown in #simulator-file) and takes an input action of type PlayerMove. It returns the state of type <code class="prettyprint">GameState</code>.</p>

<h2 id="simulator-file">Simulator File</h2>
<pre class="highlight python tab-python"><code><span class="s">""" This Basic simulator is for learning the simulator interface.
It can be used in this case to find the center between two numbers.
"""</span>
<span class="kn">import</span> <span class="nn">bonsai_ai</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">clock</span>


<span class="k">class</span> <span class="nc">BasicSimulator</span><span class="p">(</span><span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="s">""" A basic simulator class that takes in a move from the inkling file,
    and returns the state as a result of that move.
    """</span>
    <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">max</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">""" called at the start of every episode. should
        reset the simulation and return the initial state
        """</span>

        <span class="c"># reset internal initial state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span>

        <span class="c"># print out a message for our first episode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'started.'</span><span class="p">)</span>

        <span class="c"># return initial external state</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="s">""" run a single step of the simulation.
        if the simulation has reached a terminal state, mark it as such.
        """</span>

        <span class="c"># perform the action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">action</span><span class="p">[</span><span class="s">"delta"</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">record_append</span><span class="p">({</span><span class="s">"goal_count"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span><span class="p">},</span> <span class="s">"ftc"</span><span class="p">)</span>
        <span class="c"># is this episode finished?</span>
        <span class="n">terminal</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="nb">min</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="nb">max</span> <span class="ow">or</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">"value"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_count</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">episode_finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Episode'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span><span class="p">,</span>
              <span class="s">'reward:'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_reward</span><span class="p">,</span>
              <span class="s">'eps:'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">episode_rate</span><span class="p">,</span>
              <span class="s">'ips:'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration_rate</span><span class="p">,</span>
              <span class="s">'iters:'</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteration_count</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>
    <span class="c"># Analytics recording can be enabled in code or at the command line.</span>
    <span class="c"># The commented lines would have the same effect as invoking this</span>
    <span class="c"># script with "--record=find_the_center.json".</span>
    <span class="c"># Alternatively, invoking with "--record=find_the_center.csv" enables</span>
    <span class="c"># recording to CSV.</span>
    <span class="c"># config-&gt;set_record_enabled(true);</span>
    <span class="c"># config-&gt;set_record_file("find_the_center.json");</span>

    <span class="n">brain</span> <span class="o">=</span> <span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">BasicSimulator</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="s">"find_the_center_sim"</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">enable_keys</span><span class="p">([</span><span class="s">"delta_t"</span><span class="p">,</span> <span class="s">"goal_count"</span><span class="p">],</span> <span class="s">"ftc"</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'starting...'</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span>
    <span class="k">while</span> <span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">():</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">record_append</span><span class="p">(</span>
            <span class="p">{</span><span class="s">"delta_t"</span><span class="p">:</span> <span class="n">now</span> <span class="o">-</span> <span class="n">last</span><span class="p">},</span> <span class="s">"ftc"</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">clock</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000000</span>
        <span class="k">continue</span>
</code></pre><pre class="highlight cpp tab-cpp"><code><span class="c1">// Copyright (C) 2017 Bonsai, Inc.
</span>
<span class="cp">#include &lt;iostream&gt;
#include &lt;memory&gt;
#include &lt;string&gt;
#include &lt;random&gt;
#include &lt;chrono&gt;
</span>
<span class="cp">#include "bonsai.hpp"
</span>
<span class="c1">// std
</span><span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">microseconds</span><span class="p">;</span>

<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">random_device</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">mt19937</span><span class="p">;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">uniform_int_distribution</span><span class="p">;</span>

<span class="c1">// bonsai
</span><span class="k">using</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">Brain</span><span class="p">;</span>
<span class="k">using</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="p">;</span>
<span class="k">using</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="p">;</span>
<span class="k">using</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">Simulator</span><span class="p">;</span>

<span class="c1">// random number generator
</span><span class="n">random_device</span> <span class="n">rd</span><span class="p">;</span>
<span class="n">mt19937</span> <span class="n">rng</span><span class="p">(</span><span class="n">rd</span><span class="p">());</span>

<span class="c1">// basic simulator
</span><span class="k">class</span> <span class="nc">BasicSimulator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Simulator</span> <span class="p">{</span>
    <span class="k">constexpr</span> <span class="k">static</span> <span class="kt">int8_t</span> <span class="n">_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">_goal</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int8_t</span> <span class="n">_goal_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int8_t</span> <span class="n">_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">uniform_int_distribution</span><span class="o">&lt;</span><span class="kt">int8_t</span><span class="o">&gt;</span> <span class="n">_uni</span><span class="p">{</span><span class="n">_min</span><span class="p">,</span> <span class="n">_max</span><span class="p">};</span>
 <span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">BasicSimulator</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Brain</span><span class="o">&gt;</span> <span class="n">brain</span><span class="p">,</span> <span class="n">string</span> <span class="n">name</span> <span class="p">)</span>
        <span class="o">:</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">move</span><span class="p">(</span><span class="n">brain</span><span class="p">),</span> <span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">episode_start</span><span class="p">(</span><span class="k">const</span> <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span>
        <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">initial_state</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">simulate</span><span class="p">(</span><span class="k">const</span> <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
        <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span>
        <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span>
        <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">BasicSimulator</span><span class="o">::</span><span class="n">episode_start</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span>
    <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">initial_state</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// reset
</span>    <span class="n">_goal_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">_value</span> <span class="o">=</span> <span class="n">_uni</span><span class="p">(</span><span class="n">rng</span><span class="p">);</span>

    <span class="c1">// set intial state
</span>    <span class="n">initial_state</span><span class="p">.</span><span class="n">set_int8</span><span class="p">(</span><span class="s">"value"</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>

    <span class="c1">// print a message for our first episode
</span>    <span class="k">static</span> <span class="kt">bool</span> <span class="n">started</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">started</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">started</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"started."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">BasicSimulator</span><span class="o">::</span><span class="n">simulate</span><span class="p">(</span>
    <span class="k">const</span> <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
    <span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span>
    <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span>
    <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// perform the action
</span>    <span class="n">_value</span> <span class="o">+=</span> <span class="n">action</span><span class="p">.</span><span class="n">get_int8</span><span class="p">(</span><span class="s">"delta"</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_value</span> <span class="o">==</span> <span class="n">_goal</span><span class="p">)</span>
        <span class="n">_goal_count</span><span class="o">++</span><span class="p">;</span>

    <span class="c1">// output
</span>    <span class="n">state</span><span class="p">.</span><span class="n">set_int8</span><span class="p">(</span><span class="s">"value"</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span>
    <span class="n">record_append</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"goal_count"</span><span class="p">,</span> <span class="n">_goal_count</span><span class="p">,</span> <span class="s">"ftc"</span><span class="p">);</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="n">_value</span> <span class="o">&lt;</span> <span class="n">_min</span> <span class="o">||</span> <span class="n">_value</span> <span class="o">&gt;</span> <span class="n">_max</span> <span class="o">||</span> <span class="n">_goal_count</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="n">_goal_count</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>


    <span class="c1">// Analytics recording can be enabled in code or at the command line.
</span>    <span class="c1">// The commented lines have the same effect as invoking this simulator with
</span>    <span class="c1">// "--record=find_the_center.json".
</span>    <span class="c1">// Alternatively, invoking with "--record=find_the_center.csv" enables recording
</span>    <span class="c1">// to CSV.
</span>    <span class="c1">// config-&gt;set_record_enabled(true);
</span>    <span class="c1">// config-&gt;set_record_file("find_the_center.json");
</span>
    <span class="k">auto</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Brain</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
    <span class="n">BasicSimulator</span> <span class="n">sim</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="s">"find_the_center_sim"</span><span class="p">);</span>

    <span class="c1">// enable the specified keys, prepending each with "ftc" in the final log line
</span>    <span class="n">sim</span><span class="p">.</span><span class="n">enable_keys</span><span class="p">({</span><span class="s">"delta_t"</span><span class="p">,</span> <span class="s">"goal_count"</span><span class="p">},</span> <span class="s">"ftc"</span><span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"starting..."</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">last</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">run</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// You can add data to the currently active record from your top level run loop.
</span>        <span class="c1">// You can also add data to the record in your Simulator callbacks (see above).
</span>        <span class="c1">// The record gets flushed to disk at the end of each call to Simulator::run.
</span>        <span class="k">auto</span> <span class="n">millis</span> <span class="o">=</span> <span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">microseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">last</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"delta_t"</span><span class="p">,</span> <span class="n">millis</span><span class="p">,</span> <span class="s">"ftc"</span><span class="p">);</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>This is a basic simulator for learning the simulator library. In this case it is used to find the center between two numbers, 0 and 2. The goal, as outlined in the Inkling file, is to reach 1. The moves that the simulator is able to make are sent from the Inkling file to the simulator and the state of the simulator is sent back to Inkling.</p>

<p>This example also includes a demonstration of how to use the record data file functionality. Analytics recording can be enabled in code or at the command line. Usage is explained in the <a href="references/simulator-reference.html#recording-data-to-file">Recording Data to File</a> section of the Simulator Reference.</p>

<p>The <a href="https://github.com/BonsaiAI/bonsai-sdk/blob/master/samples/find-the-center-py/README.md">README file</a> contained in the project has instructions for running this simulator in either Python or C++.</p>

          <h1 id="stellar-cartpole">Stellar Cartpole</h1>

<blockquote>
<p><img src="images/cart-pole-balance.gif" alt="Cartpole Balance" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/openai-gym/gym-cartpole-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally. If you want to run Cartpole remotely on the Bonsai Platform as a managed simulator, create a new BRAIN selecting the Cartpole demo on <a href="https://beta.bons.ai/new">beta.bons.ai</a>.</p>

<p>This version of Cartpole expands on the OpenAI gym version of cartpole and exposes machine teaching logic and the rendering modeled by the classic cart-pole system implemented by Rich Sutton et al. This example will showcase the simulator file, connector file, and machine teaching file to explain how each piece is used in conjunction to train a BRAIN.</p>

<p>Cartpole is a classic control problem. <a href="https://gym.openai.com/envs/CartPole-v1">OpenAI Gym</a> describes it as:</p>

<p><em>A pole is attached by an un-actuated joint to a cart, which moves along a frictionless track. The system is controlled by applying a force of +1 or -1 to the cart. The pendulum starts upright, and the goal is to prevent it from falling over. A reward of +1 is provided for every timestep that the pole remains upright. The episode ends when the pole is more than 15 degrees from vertical, or the cart moves more than 2.4 units from the center.</em></p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">GameState</span> <span class="p">{</span>
    <span class="nx">position</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">velocity</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">angle</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">rotation</span><span class="p">:</span> <span class="k">number</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">GameState</code> defines four fields: <code class="prettyprint">position</code>, <code class="prettyprint">velocity</code>, <code class="prettyprint">angle</code>, and <code class="prettyprint">rotation</code>. This state information is provided by the simulation.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nx">command</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span><span class="o">&lt;</span><span class="nx">left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">Action</code> defines a single field <code class="prettyprint">command</code> and assigns it a constrained type.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">CartPoleConfig</span> <span class="p">{</span>
    <span class="nx">episode_length</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span><span class="p">,</span>
    <span class="nx">deque_size</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">UInt8</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">CartPoleConfig</code> defines two fields: <code class="prettyprint">episode_length</code> and <code class="prettyprint">deque_size</code>. <code class="prettyprint">episode_length</code> is a signed <code class="prettyprint">Int8</code> because -1 is used for &ldquo;run until pole drops&rdquo;.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">GameState</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="k">concept</span> <span class="nx">balance</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">cartpole_simulator</span>
            <span class="k">lesson</span> <span class="nx">balancing</span> <span class="p">{</span>
                <span class="k">constraint</span> <span class="p">{</span>
                    <span class="nx">episode_length</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="nx">deque_size</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">output</span> <span class="nx">balance</span>
<span class="p">}</span>
</code></pre>
<p>The concept is named <code class="prettyprint">balance</code>, and it takes input from the simulator of type <code class="prettyprint">GameState</code>. The balance concept outputs the move the AI should make in the simulator. The output is of type <code class="prettyprint">Action</code>.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">cartpole_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">,</span> <span class="k">config</span><span class="p">:</span> <span class="nx">CartPoleConfig</span><span class="p">):</span> <span class="nx">GameState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>Simulator <code class="prettyprint">cartpole_simulator</code> receives an action of type <code class="prettyprint">Action</code> and configuration information of type <code class="prettyprint">CartPoleConfig</code>. It returns a value of type <code class="prettyprint">GameState</code> that indicates the state of the game after the action is performed.</p>

<h2 id="simulator-file">Simulator File</h2>

<blockquote>
<p>cartpole.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">seeding</span>
<span class="kn">from</span> <span class="nn">bonsai_ai.logger</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">CartPoleModel</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="mf">9.8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masscart</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">masspole</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_mass</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">masspole</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">masscart</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c"># actually half the pole's length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polemass_length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">masspole</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_mag</span> <span class="o">=</span> <span class="mf">10.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c"># seconds between state updates</span>

        <span class="c"># Angle at which to fail the episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">360</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> <span class="o">=</span> <span class="mf">2.4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_seed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_seed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="p">,</span> <span class="n">seed</span> <span class="o">=</span> <span class="n">seeding</span><span class="o">.</span><span class="n">np_random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">seed</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">x_dot</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">state</span>
        <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_mag</span> <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">force_mag</span>
        <span class="n">costheta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">sintheta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">force</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">polemass_length</span> <span class="o">*</span> <span class="n">theta_dot</span> <span class="o">*</span> <span class="n">theta_dot</span> <span class="o">*</span> <span class="n">sintheta</span><span class="p">)</span>
            <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mass</span><span class="p">)</span>
        <span class="n">thetaacc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">*</span> <span class="n">sintheta</span> <span class="o">-</span> <span class="n">costheta</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">*</span>
               <span class="p">(</span><span class="mf">4.0</span><span class="o">/</span><span class="mf">3.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">masspole</span> <span class="o">*</span> <span class="n">costheta</span> <span class="o">*</span> <span class="n">costheta</span> <span class="o">/</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">total_mass</span><span class="p">)))</span>
        <span class="n">xacc</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">temp</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">polemass_length</span> <span class="o">*</span> <span class="n">thetaacc</span> <span class="o">*</span> <span class="n">costheta</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_mass</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="n">x_dot</span>
        <span class="n">x_dot</span> <span class="o">=</span> <span class="n">x_dot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="n">xacc</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="n">theta_dot</span>
        <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">theta_dot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">*</span> <span class="n">thetaacc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_dot</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> \
            <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> \
            <span class="ow">or</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span> \
            <span class="ow">or</span> <span class="n">theta</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span>
        <span class="n">done</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Pole just fell!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">"You are calling 'step()' even though this </span><span class="se">\
</span><span class="s">                environment has already returned done = True. You should </span><span class="se">\
</span><span class="s">                always call 'reset()' once you receive 'done = True' -- </span><span class="se">\
</span><span class="s">                any further steps are undefined behavior."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">),</span>
                <span class="n">reward</span><span class="p">,</span>
                <span class="n">done</span><span class="p">,</span>
                <span class="p">{</span><span class="s">"steps_beyond_done"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">np_random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</code></pre>
<p>This simulator file is derived from OpenAI Gym&rsquo;s cartpole environment, but re-factored to have minimal dependency, and rendering factored into a separate file, <code class="prettyprint">render.py</code>. This file contains the actual simulation of the pole balancing on the cart.</p>

<h2 id="connector-file">Connector File</h2>

<blockquote>
<p>bridge.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">bonsai_ai</span>
<span class="kn">import</span> <span class="nn">star</span>
<span class="kn">from</span> <span class="nn">cartpole</span> <span class="kn">import</span> <span class="n">CartPoleModel</span>
<span class="kn">from</span> <span class="nn">render</span> <span class="kn">import</span> <span class="n">_renderer</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">bonsai_ai</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">Logger</span><span class="p">()</span>

<span class="n">star</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">Star</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CartPoleModel</span><span class="p">()</span>
<span class="n">the_renderer</span> <span class="o">=</span> <span class="bp">None</span>


<span class="k">class</span> <span class="nc">ModelConnector</span><span class="p">(</span><span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="s">""" A basic simulator class that takes in a move from the inkling file,
    and returns the state as a result of that move.
    """</span>
    <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brain</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ModelConnector</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">""" called at the start of every episode. should
        reset the simulation and return the initial state
        """</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'Episode {} Starting'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">episode_count</span><span class="p">))</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_reset</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c"># print out a message for our first episode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">started</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'started.'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brain_action</span><span class="p">):</span>
        <span class="s">""" run a single step of the simulation.
        if the simulation has reached a terminal state, mark it as such.
        """</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">brain_action</span><span class="p">)</span>
        <span class="p">(</span><span class="n">model_state</span><span class="p">,</span>
         <span class="n">model_reward</span><span class="p">,</span>
         <span class="n">model_terminal</span><span class="p">,</span>
         <span class="n">model_info</span><span class="p">)</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">terminal</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">model_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">reward</span><span class="p">(</span><span class="n">model_terminal</span><span class="p">)</span>
        <span class="n">brain_state</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">the_renderer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">the_renderer</span><span class="o">.</span><span class="n">_render</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">brain_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminal</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">bonsai_ai</span><span class="o">.</span><span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">bridge</span> <span class="o">=</span> <span class="n">ModelConnector</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="s">'the_simulator'</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="k">if</span> <span class="s">'--render'</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'rendering'</span><span class="p">)</span>
        <span class="n">the_renderer</span> <span class="o">=</span> <span class="n">_renderer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">'starting simulation...'</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">bridge</span><span class="o">.</span><span class="n">run</span><span class="p">():</span>
        <span class="k">continue</span>
</code></pre>
<p>This file contains all of the connection code, or Python bridge code, to connect the model with the Bonsai Platform. This code facilitates the training of the BRAIN.</p>

<h2 id="machine-teaching-file">Machine Teaching File</h2>

<blockquote>
<p>star.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">bonsai_ai.logger</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Star</span><span class="p">():</span>
    <span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">model_state</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Angle at which to fail the episode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">360</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> <span class="o">=</span> <span class="mf">2.4</span>

    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
        <span class="s">""" This function converts the simulator state into the state
        representation the brain uses to learn. """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_state</span> <span class="o">=</span> <span class="n">model_state</span>
        <span class="n">brain_state</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">'position'</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'velocity'</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'angle'</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s">'rotation'</span><span class="p">:</span> <span class="n">model_state</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">brain_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">brain_state</span>

    <span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
        <span class="s">""" Terminal conditions specify when to end an episode, typically due
        to success, failure, or running out of time. In this case, we only
        terminate when the pole falls down. """</span>
        <span class="k">print</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">x_dot</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">theta_dot</span> <span class="o">=</span> <span class="n">model_state</span>
        <span class="n">done</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> <span class="ow">or</span>
                <span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_threshold</span> <span class="ow">or</span>
                <span class="n">theta</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span> <span class="ow">or</span>
                <span class="n">theta</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta_threshold_radians</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">done</span>

    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brain_action</span><span class="p">):</span>
        <span class="s">""" This function converts the action representation the brain learns
        to use into the action representation the simulator uses to act in the
        simulated environment. """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">model_action</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">brain_action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">model_action</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">model_action</span>

    <span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">done</span><span class="p">):</span>
        <span class="s">""" Give the brain feedback on how well it is doing in this episode.
        In this case, this is simply 1 every time period that the pole is
        balanced. The brain's job is to learn to maximize the reward it gets
        during the episode, which corresponds to balancing as long as possible.
        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Pole just fell!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"You are calling 'step()' even though this </span><span class="se">\
</span><span class="s">                         environment has already returned done = True. </span><span class="se">\
</span><span class="s">                         You should always call 'reset()' once you receive </span><span class="se">\
</span><span class="s">                         'done = True' -- any further steps are undefined </span><span class="se">\
</span><span class="s">                         behavior."</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">reward</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iteration_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">brain_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">(</span><span class="n">model_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steps_beyond_done</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">brain_state</span>
</code></pre>
<p>This file contains the machine teaching logic, refered to as STAR, which stands for state, terminal, action, and reward functions. Through experimentation this is the code you will be changing to speed up training time or refine your reward function.</p>

          <h1 id="simpy-elevator-simulation">SimPy Elevator Simulation</h1>

<blockquote>
<p><img src="images/elevator_output.png" alt="ASCII Elevator Output" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/elevator-sim"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally.</p>

<p>In this example, <a href="https://simpy.readthedocs.io/en/latest/index.html">SimPy</a>, a process-based discrete-event simulation framework based on standard Python, is used to simulate an elevator effectively transporting people to their desired floor. The simulated elevator gets rewarded by having people wait for the least time. This example includes a simple elevator SimPy simulator, a Python simulation, and an Inkling file.</p>

<p>&ldquo;Processes in SimPy are defined by Python generator functions and may, for example, be used to model active components like customers, vehicles or agents. SimPy also provides various types of shared resources to model limited capacity congestion points (like servers, checkout counters and tunnels).&rdquo; - SimPy docs</p>

<p>This simulation consumes actions (up, down, open doors) for an elevator given floor requests from randomly-arriving passengers. SimPy has a great framework for simulating time only when state changes occur. This speeds up training for systems that would otherwise be mostly waiting.</p>

<p>In the image to the right, the elevator logs output every 100 seconds, then shows the state of the world, and then a list of recent passengers. The world state is the floor, the number of people waiting, plus the elevator, and the number of people inside.</p>

<p><code class="prettyprint">1: 0| 2: 1| 3: 0| [_1_]</code> shows zero people on the first floor, one person waiting on the second floor, and one person in the elevator on the third floor.</p>

<p>For more ideas of how SimPy can simulate real world problems see the <a href="https://simpy.readthedocs.io/en/latest/examples/index.html#examples">SimPy Examples page</a>.</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">FloorState</span> <span class="p">{</span>
    <span class="nx">Position</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">Floor1</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">Floor2</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="nx">Floor3</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">FloorState</code> type defines the fields returned by the simulation&rsquo;s <code class="prettyprint">advance</code> method.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nx">command</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="nx">up</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">open</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">down</span> <span class="o">=</span> <span class="mi">2</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">Action</code> type defines the possible commands accepted by the elevator. In this case, the command given to the elevator is &lsquo;0&rsquo; to open the door, &lsquo;1&rsquo; to go up a floor, and &lsquo;2&rsquo; to go down a floor.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">ElevatorConfig</span> <span class="p">{</span>
    <span class="nx">episode_length</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span>
<span class="p">}</span>
</code></pre>
<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">FloorState</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="k">concept</span> <span class="nx">elevator_plan</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">elevator_simulator</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">output</span> <span class="nx">elevator_plan</span>
<span class="p">}</span>
</code></pre>
<p>This concept is named <code class="prettyprint">elevator_plan</code>, and it computes an <code class="prettyprint">Action</code> given the current <code class="prettyprint">FloorState</code>. In this simple example, we are training the concept to make an action (go up a floor, go down a floor, or open the doors) based on the current state of the floor.</p>

<p>The curriculum uses simulator <code class="prettyprint">elevator_simulator</code> as its data source. No lesson is specified, so a single simple lesson is assumed.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">elevator_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">):</span> <span class="nx">FloorState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>The simulator clause declares that a simulator named <code class="prettyprint">elevator_simulator</code> will be connecting to the server for training. This <code class="prettyprint">elevator_simulator</code> expects an input action of type <code class="prettyprint">Action</code> and replies with a value of type <code class="prettyprint">FloorState</code>.</p>

<h2 id="simulator-excerpt">Simulator Excerpt</h2>
<pre class="highlight python tab-python"><code><span class="c"># Excerpt of simulator class from the elevator_simulator.py file</span>

<span class="k">class</span> <span class="nc">ElevatorSimulator</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'called episode_start'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
        <span class="n">floors</span> <span class="o">=</span> <span class="p">[</span><span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">BUILDING_SIZE</span><span class="p">)]</span>
        <span class="n">store</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Store</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">elevator</span><span class="o">.</span><span class="n">Lstate</span><span class="p">()</span>
        <span class="n">person_score</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">elevator</span><span class="o">.</span><span class="n">claim</span><span class="p">(</span><span class="n">floors</span><span class="p">,</span> <span class="n">reqs</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">elevator</span><span class="o">.</span><span class="n">person_generator</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">floors</span><span class="p">,</span> <span class="n">person_score</span><span class="p">))</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">elevator</span><span class="o">.</span><span class="n">display_process</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">person_score</span><span class="p">,</span> <span class="n">state</span><span class="p">))</span>

        <span class="c"># We use the single step version of elevator (elevator_one)</span>
        <span class="c"># this allows the simulator to run until the elevator uses a command.</span>
        <span class="n">ep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
            <span class="n">elevator</span><span class="o">.</span><span class="n">elevator_one</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">floors</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">store</span><span class="p">,</span> <span class="n">reqs</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">floors</span> <span class="o">=</span> <span class="n">floors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">store</span> <span class="o">=</span> <span class="n">store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">person_score</span> <span class="o">=</span> <span class="n">person_score</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reqs</span> <span class="o">=</span> <span class="n">reqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="o">=</span> <span class="n">ep</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
        <span class="c"># print('[advance]', end='')</span>
        <span class="c"># print('command: {}'.format(command))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>

        <span class="c"># pass our command to a resource by way of this doit() method</span>
        <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">doit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span>

        <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">elevator</span><span class="o">.</span><span class="n">elevator_one</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">floors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reqs</span><span class="p">))</span>
        <span class="c"># print('stepped to {}'.format(env.now))</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state</span><span class="p">()</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_done</span><span class="p">()</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># only calculate reward for training mode</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">:</span>
            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elevator_objective</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_state</span><span class="p">(),</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span>

    <span class="k">def</span> <span class="nf">_get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">""" return the current state of the simulation """</span>

        <span class="c"># print('[get_state]', end='')</span>

        <span class="c"># if a floor is requested, state=1</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">queue</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">floors</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">'Floor{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="n">v</span> <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)}</span>
        <span class="n">state</span><span class="p">[</span><span class="s">'Position'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">floor</span>
        <span class="c"># print(state)</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">_get_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">&gt;</span> <span class="n">SIM_TIME</span>
        <span class="k">return</span> <span class="n">done</span>

    <span class="k">def</span> <span class="nf">_elevator_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># print('[objective]', end='')</span>
        <span class="n">waiting</span> <span class="o">=</span> <span class="n">elevator</span><span class="o">.</span><span class="n">count_waiting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">person_score</span><span class="p">)</span>
        <span class="c"># print("returning score %d for %d people" % (active, len(scores)))</span>

        <span class="c"># return as negative because the simulator maximizes this value.</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">waiting</span>
</code></pre>
<p>The full simulator file <em>elevator_simulator.py</em> and elevator simulation file <em>elevator.py</em> for this example is with the rest of the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/elevator-sim">simpy-elevator code</a> on GitHub.</p>

<p>This is a Python simulator which uses the elevator.py custom Python simulation using SimPy. This <em>elevator_simulator.py</em> file repeatedly runs the elevator simulation for each episode of training to get details of where people start out, how many are on the elevator, and what floor they are going to, etc. Each episode the curriculum in Inkling trains the concept by sending a new <code class="prettyprint">Action</code> to the BRAIN based on the <code class="prettyprint">FloorState</code> of the simulator.</p>

<p>The <code class="prettyprint">_elevator_objective</code> function returns a negative waiting value because this value is going to be maximized, and we want to actually minimize the collective group of people&rsquo;s wait time.</p>

<p>For more information on the functions inside of this simulator class and how to implement them see the <a href="http://docs.bons.ai/references/library-reference.html">Library Reference</a>.</p>

<p>Also note that if you would like to see how this simulator can be run without Bonsai - to demonstrate how the emulator behaves with a hard-coded algorithm - you can do so by running elevator.py simply with Python itself.</p>

          <h1 id="luminance-tic-tac-toe">Luminance tic-tac-toe</h1>

<blockquote>
<p><img src="images/Tic-Tac-Toe.gif" alt="Tic-Tac-Toe" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/tic-tac-toe"><strong>Download the full source code on GitHub</strong></a> to run this simulator.</p>

<p>To demonstrate the use of images in the Bonsai platform, this example will walk you through a simple implementation of tic-tac-toe. The full Inkling file is presented to walk through each part of the file and the rest of the code to run the example is found at the link above.</p>
<pre class="highlight python tab-python"><code><span class="n">letters</span> <span class="o">=</span> <span class="p">{</span><span class="s">"X"</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span>
           <span class="s">"O"</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
           <span class="s">" "</span><span class="p">:</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]}</span>
</code></pre>
<p>This example will train a BRAIN using a 9x9 grayscale pixel grid (an input matrix) to represent the tic-tac-toe board. The representation of each letter, X, O, and a blank space, each are represented by a 3x3 matrix as shown in the code panel. There are 9 options for movement to correspond with the 9 spaces on the board.</p>

<p>This example also contains an advanced-level algorithm clause in its Inkling File. This clause is not required, but it will help the example train much faster. For more information on use of the algorithm clause see the <a href="references/inkling2-reference.html#advanced-algorithms">Inkling Reference</a>.</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">GameState</span> <span class="p">{</span>
    <span class="nx">image</span><span class="p">:</span> <span class="nb">Image</span><span class="p">.</span><span class="nb">Gray</span><span class="o">&lt;</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">GameState</code> type defines a field <code class="prettyprint">image</code> that uses the complex type <code class="prettyprint">Image.Gray</code> to create a 9x9 pixel grid (an input matrix) to represent all possible states of the tic-tac-toe board. Each letter (or blank space) is a 3x3 image, so a 3x3 grid of 3x3 letters (or blanks) results in a 9x9 grid.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">PlayerMove</span> <span class="p">{</span>
    <span class="nx">move</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">PlayerMove</code> type classifies all 9 possible moves the AI can make, one for each space on the tic-tac-toe board.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">GameState</span><span class="p">):</span> <span class="nx">PlayerMove</span> <span class="p">{</span>
    <span class="k">concept</span> <span class="nx">play_tictactoe</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">PlayerMove</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">algorithm</span> <span class="p">{</span>
                <span class="nx">Algorithm</span><span class="p">:</span> <span class="s2">"DQN"</span><span class="p">,</span>
                <span class="nx">ConvolutionLayers</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="nx">XSize</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="nx">YSize</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="nx">XStride</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="nx">YStride</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
                    <span class="nx">FilterCount</span><span class="p">:</span> <span class="mi">2</span>
                <span class="p">}]</span>
            <span class="p">}</span>
            <span class="k">source</span> <span class="nx">tictactoe_simulator</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">output</span> <span class="nx">play_tictactoe</span>
<span class="p">}</span>
</code></pre>
<p>The concept, <code class="prettyprint">play_tictactoe</code>, returns a value of type <code class="prettyprint">PlayerMove</code> which indicates which of nine possible actions should be taken. The AI picks this action based on the current state of the game, <code class="prettyprint">GameState</code> as an input.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">tictactoe_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">PlayerMove</span><span class="p">):</span> <span class="nx">GameState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>The simulator clause declares that a simulator named <code class="prettyprint">tictactoe_simulator</code> will be connecting to the server for training. This <code class="prettyprint">tictactoe_simulator</code> expects an action of type <code class="prettyprint">PlayerMove</code> as input and replies with a value of type <code class="prettyprint">GameState</code>.</p>

<p>The algorithm clause provides a hint to the AI Engine that a <code class="prettyprint">DQN</code> algorithm should be used. It also sets some parameters for this algorithm. This hint is not required for this example but it will help the example train much faster. For more information on use of the algorithm clause see the <a href="references/inkling2-reference.html#advanced-algorithms">Inkling Reference</a>.</p>

<h2 id="simulator-file">Simulator File</h2>

<p>The full simulator file <em>tictactoe_simulator.py</em> for this example is too long to display in full here but you can see it with the rest of the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/tic-tac-toe">tic-tac-toe sample code</a> on GitHub.</p>

<p>For more information on the functions inside of this simulator file and how to implement them see the <a href="references/library-reference.html">Library Reference</a>.</p>

          <h1 id="openai-gym-mountain-car">OpenAI Gym: Mountain Car</h1>

<blockquote>
<p><img src="images/mountain-car-control.gif" alt="Mountain Car Control" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/openai-gym/gym-mountaincar-continuous-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally. If you want to run Mountain Car remotely on the Bonsai Platform as a managed simulator, create a new BRAIN selecting the Mountain Car demo on <a href="https://beta.bons.ai/new">beta.bons.ai</a></p>

<p>We&rsquo;ve used pieces of code from this example in several places, but here we&rsquo;ll walk you through all the various statements that are part of the Mountain Car Inkling file. Each statement is followed by an explanation of the statement.</p>

<p>Mountain Car is a classic control problem. <a href="https://gym.openai.com/envs/MountainCarContinuous-v0/">OpenAI Gym</a> describes it as:</p>

<p><em>A car is on a one-dimensional track, positioned between two &ldquo;mountains&rdquo;. The goal is to drive up the mountain on the right; however, the car&rsquo;s engine is not strong enough to scale the mountain in a single pass. Therefore, the only way to succeed is to drive back and forth to build up momentum.</em></p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">GameState</span> <span class="p">{</span>
    <span class="nx">x_position</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">x_velocity</span><span class="p">:</span> <span class="k">number</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">GameState</code> type defines two fields  <code class="prettyprint">x_position</code> and <code class="prettyprint">y_position</code>.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">const</span> <span class="nx">throttleMin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="k">const</span> <span class="nx">throttleMax</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="k">type</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nx">command</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="nx">throttleMin</span> <span class="p">..</span> <span class="nx">throttleMax</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">Action</code> type defines a single field  <code class="prettyprint">command</code>  and assigns it a constrained type.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">MountainCarConfig</span> <span class="p">{</span>
    <span class="nx">deque_size</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">UInt8</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">MountainCarConfig</code> type defines a single field - <code class="prettyprint">deque_size</code>.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">GameState</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="k">concept</span> <span class="nx">high_score</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">mountaincar_continuous_simulator</span>
            <span class="k">lesson</span> <span class="nx">get_high_score</span> <span class="p">{</span>
                <span class="k">constraint</span> <span class="p">{</span>
                    <span class="nx">deque_size</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">output</span> <span class="nx">high_score</span>
<span class="p">}</span>
</code></pre>
<p>The output concept is named <code class="prettyprint">high_score</code>, and it takes input from the simulator about the state of the game (which is of type <code class="prettyprint">GameState</code>). It outputs a value of type <code class="prettyprint">Action</code>. This is the AI&rsquo;s next move in the game.</p>

<p>The curriculum uses the simulator <code class="prettyprint">mountaincar_simulator</code> as its data source. One lesson is specified, and it configures the simulation by constraining the deque_size field to a value of 1.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">mountaincar_continuous_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">,</span> <span class="k">config</span><span class="p">:</span> <span class="nx">MountainCarConfig</span><span class="p">):</span> <span class="nx">GameState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">mountaincar_continuous_simulator</code> receives actions of type <code class="prettyprint">Action</code> and configuration information of type <code class="prettyprint">MountainCarConfig</code>. It outputs values of type <code class="prettyprint">GameState</code>.</p>

<h2 id="simulator-file">Simulator File</h2>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">Brain</span><span class="p">,</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">bonsai_gym</span> <span class="kn">import</span> <span class="n">GymSimulator</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'gym_simulator'</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MountainCarContinuous</span><span class="p">(</span><span class="n">GymSimulator</span><span class="p">):</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="s">'MountainCarContinuous-v0'</span>
    <span class="n">simulator_name</span> <span class="o">=</span> <span class="s">'mountaincar_continuous_simulator'</span>

    <span class="k">def</span> <span class="nf">gym_to_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">'x_position'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'x_velocity'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="c"># As an Estimator, continuous mountaincar returns the command</span>
    <span class="c"># as a numpy array.</span>
    <span class="k">def</span> <span class="nf">action_to_gym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="c"># return actions['command']</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">actions</span><span class="p">[</span><span class="s">'command'</span><span class="p">]])</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># create a brain, openai-gym environment, and simulator</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">MountainCarContinuous</span><span class="p">(</span><span class="n">brain</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_gym</span><span class="p">()</span>
</code></pre>
<p>This is an OpenAI Gym example which uses the OpenAI environment as its simulator. For more information about the simulator used see the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/bonsai-gym">Bonsai Gym Common GitHub repo</a> which is a python library for integrating a Bonsai BRAIN with OpenAI Gym environments.</p>

          <h1 id="openai-gym-cartpole">OpenAI Gym: Cartpole</h1>

<blockquote>
<p><img src="images/cart-pole-balance.gif" alt="Cartpole Balance" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/openai-gym/gym-cartpole-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally.</p>

<aside class="notice">
This example has now been replaced by the Stellar Cartpole example as the default Cartpole when you create a &ldquo;Cartpole&rdquo; demo on the platform.
</aside>

<p>In this example, we&rsquo;ll walk you through the various statements that are part of the Cartpole Inkling file. Each statement is followed by an explanation of the statement.</p>

<p>Cartpole is a classic control problem. <a href="https://gym.openai.com/envs/CartPole-v1">OpenAI Gym</a> describes it as:</p>

<p><em>A pole is attached by an un-actuated joint to a cart, which moves along a frictionless track. The system is controlled by applying a force of +1 or -1 to the cart. The pendulum starts upright, and the goal is to prevent it from falling over. A reward of +1 is provided for every timestep that the pole remains upright. The episode ends when the pole is more than 15 degrees from vertical, or the cart moves more than 2.4 units from the center.</em></p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">GameState</span> <span class="p">{</span>
    <span class="nx">position</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">velocity</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">angle</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">rotation</span><span class="p">:</span> <span class="k">number</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">GameState</code> defines four fields - <code class="prettyprint">position</code>, <code class="prettyprint">velocity</code>, <code class="prettyprint">angle</code>, and <code class="prettyprint">rotation</code>  and assigns a type to each. This information is input from the simulation.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">Action</span> <span class="p">{</span>
    <span class="nx">command</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="nx">Left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Right</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">Action</code> defines a single flield  <code class="prettyprint">action</code>   and assigns it a constrained type.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">CartPoleConfig</span> <span class="p">{</span>
    <span class="nx">episode_length</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int8</span><span class="p">,</span>
    <span class="nx">deque_size</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">UInt8</span>
<span class="p">}</span>
</code></pre>
<p>The type <code class="prettyprint">CartPoleConfig</code> defines two fields  <code class="prettyprint">episode_length</code> and
 <code class="prettyprint">deque_size</code>  and assigns each of them a type.  <code class="prettyprint">episode_length</code> is a signed <code class="prettyprint">Int8</code> because -1 is used for &ldquo;run until pole drops&rdquo;.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">GameState</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>

    <span class="k">concept</span> <span class="nx">balance</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">Action</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">cartpole_simulator</span>

            <span class="k">lesson</span> <span class="nx">balancing</span> <span class="p">{</span>
                <span class="k">constraint</span> <span class="p">{</span>
                    <span class="nx">episode_length</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="nx">deque_size</span><span class="p">:</span> <span class="mi">1</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">output</span> <span class="nx">balance</span>
<span class="p">}</span>
</code></pre>
<p>The concept is named <code class="prettyprint">balance</code>, and it takes input from the simulator. That input is of type <code class="prettyprint">GameState</code>. The balance concept outputs the move the AI should make in the simulator. This output is of type <code class="prettyprint">Action</code>.</p>

<p>The curriculum defines one lesson, called <code class="prettyprint">balancing</code>. It constrains the simulator&rsquo;s configuration such that the <code class="prettyprint">episode_length</code> is -1 and the <code class="prettyprint">deque_size</code> is 1 for all episodes.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">cartpole_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">Action</span><span class="p">,</span> <span class="k">config</span><span class="p">:</span> <span class="nx">CartPoleConfig</span><span class="p">):</span> <span class="nx">GameState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>Simulator <code class="prettyprint">cartpole_simulator</code> receives inputs of two types. The first, <code class="prettyprint">Action</code>, specifies the action that the AI will take in the simulation. The second, <code class="prettyprint">CartPoleConfig</code>, specifies the configuration of the simulation. The simulator outputs a value of type <code class="prettyprint">GameState</code> which contains the state of the simulator at each iteration.</p>

<h2 id="simulator-file">Simulator File</h2>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">Brain</span><span class="p">,</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">bonsai_gym</span> <span class="kn">import</span> <span class="n">GymSimulator</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'gym_simulator'</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CartPole</span><span class="p">(</span><span class="n">GymSimulator</span><span class="p">):</span>
    <span class="c"># Environment name, from openai-gym</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="s">'CartPole-v0'</span>

    <span class="c"># simulator name from Inkling</span>
    <span class="n">simulator_name</span> <span class="o">=</span> <span class="s">'cartpole_simulator'</span>

    <span class="c"># convert openai gym observation to our state type</span>
    <span class="k">def</span> <span class="nf">gym_to_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">'position'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'velocity'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s">'angle'</span><span class="p">:</span>    <span class="n">observation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s">'rotation'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="c"># convert our action type into openai gym action</span>
    <span class="k">def</span> <span class="nf">action_to_gym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># create a brain, openai-gym environment, and simulator</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">CartPole</span><span class="p">(</span><span class="n">brain</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_gym</span><span class="p">()</span>
</code></pre>
<p>This is an OpenAI Gym example which uses the OpenAI environment as its simulator. For more information about the simulator used see the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/bonsai-gym">Bonsai Gym Common GitHub repo</a> which is a python library for integrating a Bonsai BRAIN with OpenAI Gym environments.</p>

          <h1 id="predictor-class-cartpole">Predictor Class Cartpole</h1>

<blockquote>
<p><img src="images/cart-pole-balance.gif" alt="Cartpole Balance" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/openai-gym/gym-cartpole-predictor-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator.</p>

<p>This example demonstrates how the <code class="prettyprint">Predictor</code> class can be used to obtain predictions from a trained BRAIN. This is an alternative method to using the CLI to obtain predictions using the <code class="prettyprint">--predict</code> flag with Bonsai&rsquo;s Python SDK.</p>

<p>Cartpole is a classic control problem. <a href="https://gym.openai.com/envs/CartPole-v1">OpenAI Gym</a> describes it as:</p>

<p><em>A pole is attached by an un-actuated joint to a cart, which moves along a frictionless track. The system is controlled by applying a force of +1 or -1 to the cart. The pendulum starts upright, and the goal is to prevent it from falling over. A reward of +1 is provided for every timestep that the pole remains upright. The episode ends when the pole is more than 15 degrees from vertical, or the cart moves more than 2.4 units from the center.</em></p>

<h2 id="inkling-file">Inkling File</h2>

<p>The Inkling for this example is exactly the same as the original <a href="#openai-gym-cartpole">Cartpole OpenAI Gym example</a> above. See the previous example for details on how the Inkling works for training cartpole.</p>

<h2 id="simulator-file">Simulator File</h2>

<blockquote>
<p>cartpole_simulator.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">Brain</span><span class="p">,</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">bonsai_gym</span> <span class="kn">import</span> <span class="n">GymSimulator</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">'gym_simulator'</span><span class="p">)</span>
<span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CartPole</span><span class="p">(</span><span class="n">GymSimulator</span><span class="p">):</span>
    <span class="c"># Environment name, from openai-gym</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="s">'CartPole-v0'</span>

    <span class="c"># simulator name from Inkling</span>
    <span class="c"># Example Inkling:</span>
    <span class="c">#   curriculum balance_curriculum</span>
    <span class="c">#       train balance</span>
    <span class="c">#       with simulator cartpole_simulator</span>
    <span class="c">#       ....</span>
    <span class="n">simulator_name</span> <span class="o">=</span> <span class="s">'cartpole_simulator'</span>

    <span class="c"># convert openai gym observation to our state type</span>
    <span class="c"># Example Inkling:</span>
    <span class="c">#   type GameState {</span>
    <span class="c">#       position: number,</span>
    <span class="c">#       velocity: number,</span>
    <span class="c">#       angle: number,</span>
    <span class="c">#       rotation: number</span>
    <span class="c">#   }</span>
    <span class="k">def</span> <span class="nf">gym_to_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">'position'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="s">'velocity'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="s">'angle'</span><span class="p">:</span>    <span class="n">observation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                 <span class="s">'rotation'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="c"># convert our action type into openai gym action</span>
    <span class="c"># Example Inkling:</span>
    <span class="c">#   type Action {</span>
    <span class="c">#       command: number&lt;0, 1&gt;</span>
    <span class="c">#   }</span>
    <span class="k">def</span> <span class="nf">action_to_gym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># create a brain, openai-gym environment, and simulator</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">CartPole</span><span class="p">(</span><span class="n">brain</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">.</span><span class="n">run_gym</span><span class="p">()</span>

</code></pre>
<p>This is an OpenAI Gym example which uses the OpenAI environment as its simulator. For more information about the simulator used see the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/bonsai-gym">Bonsai Gym</a> folder in the bonsai-sdk GitHub repo which is a python library for integrating a Bonsai BRAIN with OpenAI Gym environments.</p>

<h2 id="predictor-file">Predictor File</h2>

<blockquote>
<p>cartpole_predictor.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">Brain</span><span class="p">,</span> <span class="n">Config</span><span class="p">,</span> <span class="n">Predictor</span>
<span class="kn">from</span> <span class="nn">bonsai_ai.logger</span> <span class="kn">import</span> <span class="n">Logger</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>
<span class="n">log</span><span class="o">.</span><span class="n">set_enabled</span><span class="p">(</span><span class="s">"info"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_state</span><span class="p">(</span><span class="n">observation</span><span class="p">):</span>
    <span class="s">""" Converts gym observation into Inkling state dictionary """</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s">'position'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="s">'velocity'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
             <span class="s">'angle'</span><span class="p">:</span>    <span class="n">observation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
             <span class="s">'rotation'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
    <span class="k">return</span> <span class="n">state</span>


<span class="k">def</span> <span class="nf">_action</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
    <span class="s">""" Converts Inkling action into a gym action """</span>
    <span class="k">return</span> <span class="n">action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_log_state_and_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"The BRAIN received the following state: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">"The BRAIN returned the following action: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># Set up predictor</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">predictor</span> <span class="o">=</span> <span class="n">Predictor</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="s">'cartpole_simulator'</span><span class="p">)</span>

    <span class="c"># Set up cartpole simulator</span>
    <span class="n">episode_count</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s">'CartPole-v0'</span><span class="p">)</span>

    <span class="c"># Reset, get state, exchange state for action, and then step the sim</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">_state</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">_action</span><span class="p">(</span><span class="n">predictor</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
    <span class="n">_log_state_and_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

    <span class="c"># Loop until episode_count is reached</span>
    <span class="k">while</span> <span class="n">episode_count</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">_state</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">_action</span><span class="p">(</span><span class="n">predictor</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="n">_log_state_and_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
            <span class="n">episode_count</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">observation</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

</code></pre>
<p>This <code class="prettyprint">cartpole_predictor.py</code> file contains all the code necessary to obtain predictions from a trained BRAIN. This predictor file converts the action and state spaces from the cartpole simulator (this is the same simulator as the original OpenAI Gym example) and logs the prediction results.</p>

          <h1 id="event-pump-cartpole">Event Pump Cartpole</h1>

<blockquote>
<p><img src="images/cart-pole-balance.gif" alt="Cartpole Balance" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/openai-gym/gym-cartpole-event-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator.</p>

<p>This example demonstrates how instances of the <code class="prettyprint">Event</code> class can be used to drive a custom simulation loop. Rather than relying on machinery internal to <code class="prettyprint">bonsai_ai.Simulator</code>, the <code class="prettyprint">CartPoleTrainer</code> class advances the simulation event by event, which, in turn, allows for custom logic at each stage.</p>

<p>This event-driven interface is useful when you can&rsquo;t squeeze your particular application logic into the prescribed callback interface.</p>

<p>Cartpole is a classic control problem. <a href="https://gym.openai.com/envs/CartPole-v1">OpenAI Gym</a> describes it as:</p>

<p><em>A pole is attached by an un-actuated joint to a cart, which moves along a frictionless track. The system is controlled by applying a force of +1 or -1 to the cart. The pendulum starts upright, and the goal is to prevent it from falling over. A reward of +1 is provided for every timestep that the pole remains upright. The episode ends when the pole is more than 15 degrees from vertical, or the cart moves more than 2.4 units from the center.</em></p>

<h2 id="inkling-file">Inkling File</h2>

<p>The Inkling for this example is exactly the same as the original <a href="#openai-gym-cartpole">Cartpole OpenAI Gym example</a> above. See the previous example for details on how the Inkling works for training cartpole.</p>

<h2 id="simulator-file">Simulator File</h2>

<blockquote>
<p>cartpole_simulator.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">Brain</span><span class="p">,</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">bonsai_gym</span> <span class="kn">import</span> <span class="n">GymSimulator</span>
<span class="kn">from</span> <span class="nn">bonsai_ai.logger</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">bonsai_ai</span> <span class="kn">import</span> <span class="n">EpisodeStartEvent</span><span class="p">,</span> <span class="n">SimulateEvent</span><span class="p">,</span> \
    <span class="n">EpisodeFinishEvent</span><span class="p">,</span> <span class="n">FinishedEvent</span><span class="p">,</span> <span class="n">UnknownEvent</span>

<span class="kn">from</span> <span class="nn">star</span> <span class="kn">import</span> <span class="n">state</span><span class="p">,</span> <span class="n">terminal</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">params</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CartPole</span><span class="p">(</span><span class="n">GymSimulator</span><span class="p">):</span>
    <span class="c"># Environment name, from openai-gym</span>
    <span class="n">environment_name</span> <span class="o">=</span> <span class="s">'CartPole-v0'</span>

    <span class="c"># simulator name from Inkling</span>
    <span class="c"># Example Inkling:</span>
    <span class="c">#   curriculum balance_curriculum</span>
    <span class="c">#       train balance</span>
    <span class="c">#       with simulator cartpole_simulator</span>
    <span class="c">#       ....</span>
    <span class="n">simulator_name</span> <span class="o">=</span> <span class="s">'cartpole_simulator'</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CartPoleTrainer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span> <span class="o">=</span> <span class="n">sim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_episode_reward</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span><span class="o">.</span><span class="n">get_next_event</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">EpisodeStartEvent</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">"Episode Start"</span><span class="p">)</span>
            <span class="n">observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span><span class="o">.</span><span class="n">gym_episode_start</span><span class="p">(</span><span class="n">params</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
            <span class="n">event</span><span class="o">.</span><span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">SimulateEvent</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">"Simulate"</span><span class="p">)</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">rwd</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span><span class="o">.</span><span class="n">gym_simulate</span><span class="p">(</span><span class="n">action</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
            <span class="n">event</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span><span class="p">(</span><span class="n">rwd</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="n">terminal</span><span class="p">(</span><span class="n">done</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_episode_reward</span> <span class="o">+=</span> <span class="n">rwd</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">EpisodeFinishEvent</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">"Episode Finish"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Episode {} reward: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_episode_reward</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_episode_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_episode_reward</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">FinishedEvent</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">event</span><span class="p">(</span><span class="s">"Finished"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c"># create a brain, openai-gym environment, and simulator</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">brain</span> <span class="o">=</span> <span class="n">Brain</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">CartPole</span><span class="p">(</span><span class="n">brain</span><span class="p">)</span>
    <span class="n">trainer</span> <span class="o">=</span> <span class="n">CartPoleTrainer</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">trainer</span><span class="o">.</span><span class="n">run</span><span class="p">():</span>
        <span class="k">pass</span>

</code></pre>
<p>This is an OpenAI Gym example which uses the OpenAI environment as its simulator. For more information about the simulator used see the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/bonsai-gym">Bonsai Gym</a> folder in the bonsai-sdk GitHub repo which is a python library for integrating a Bonsai BRAIN with OpenAI Gym environments.</p>

<p>You will notice that unlike the original cartpole example, this example imports <code class="prettyprint">EpisodeStartEvent</code>, <code class="prettyprint">SimulateEvent</code>, <code class="prettyprint">EpisodeFinishEvent</code>, <code class="prettyprint">FinishedEvent</code>, <code class="prettyprint">UnknownEvent</code> from the <code class="prettyprint">bonsai-ai</code> library. These classes are subclasses of the <a href="references/library-reference.html#event-class">Event class</a> which drive the simulation event by event, allowing for custom logic at each stage.</p>

<h2 id="machine-teaching-file">Machine Teaching File</h2>

<blockquote>
<p>star.py</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="n">observation</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">'position'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s">'velocity'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s">'angle'</span><span class="p">:</span>    <span class="n">observation</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="s">'rotation'</span><span class="p">:</span> <span class="n">observation</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>


<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">action</span><span class="p">[</span><span class="s">'command'</span><span class="p">]</span>


<span class="c"># included for completeness w.r.t. the "STAR" pattern</span>
<span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>


<span class="c"># included for completeness w.r.t. the "STAR" pattern</span>
<span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">initial_properties</span>
</code></pre>
<p>This <code class="prettyprint">star.py</code> file houses the machine teaching aspects of the Bonsai Platform in a single file, instead of keeping them combined with the rest of the simulator code, or hiding inside of the Gym Common library (which is where it is in the original Cartpole file). This is a useful tool when experimenting with different reward functions, terminal conditions, or other aspects of machine teaching.</p>

<p>You will notice that the terminal conditions and reward function are still maintained within the default gym environment for Cartpole, but they have been included here for completeness.</p>

          <h1 id="energyplus-hvac-optimization">EnergyPlus HVAC Optimization</h1>

<blockquote>
<p><img src="images/energyplus-graph.png" alt="EnergyPlus Graph" /></p>
</blockquote>

<p><a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/energyplus-sample"><strong>Download the full source code on GitHub</strong></a> if you want to run this simulator locally. If you want to run EnergyPlus remotely on the Bonsai Platform as a managed simulator, create a new BRAIN selecting the EnergyPlus demo on <a href="https://beta.bons.ai/new">beta.bons.ai</a>.</p>

<p>In this example, we&rsquo;ll walk you through the statements that are part of a sample implementation of <a href="https://energyplus.net/">EnergyPlus</a> on the Bonsai Platform. This is a real-world example of how to use the Bonsai Platform for HVAC control using BCVTB and EnergyPlus.</p>

<p>While this BRAIN is training, the Bonsai AI Engine invokes the EnergyPlus simulator for every episode. The <em>energyplus_simulator.py</em> then drives the simulator forward a step at a time until it finishes the episode and then resets it for the next episode, driving the actions into it and sending states back to the Bonsai AI Engine.</p>

<h2 id="inkling-file">Inkling File</h2>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">const</span> <span class="nx">minIrradiation</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int32</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">const</span> <span class="nx">maxIrradiation</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int32</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">type</span> <span class="nx">SimState</span> <span class="p">{</span>
    <span class="nx">SolarIrradiation</span><span class="p">:</span> <span class="nb">Number</span><span class="p">.</span><span class="nb">Int32</span><span class="o">&lt;</span><span class="nx">minIrradiation</span> <span class="p">..</span> <span class="nx">maxIrradiation</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">SimState</code> type describes the value returned from the Python simulation&rsquo;s <code class="prettyprint">simulate</code> method to the BRAIN. We have added constants to demonstrate how they can be used in defining types.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">SimAction</span> <span class="p">{</span>
    <span class="nx">shade</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="nx">Up</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Down</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">SimAction</code> type defines the control signals this AI can send to the climate control. In this case, the shade can be either up or down.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">SimState</span><span class="p">):</span> <span class="nx">SimAction</span> <span class="p">{</span>

    <span class="k">concept</span> <span class="nx">my_concept</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">SimAction</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">energyplus_simulator</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">output</span> <span class="nx">my_concept</span>
<span class="p">}</span>
</code></pre>
<p>This concept is named <code class="prettyprint">my_concept</code> which outputs a <code class="prettyprint">SimAction</code> given a <code class="prettyprint">SimState</code>. In this simple demo, we ask the Bonsai Platform to generate any model that can learn to control the system using these inputs and outputs.</p>

<p>The curriculum trains <code class="prettyprint">my_concept</code> using <code class="prettyprint">energyplus_simulator</code>. This curriculum has no defined lesson, so a default lesson is assumed.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">energyplus_simulator</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">SimAction</span><span class="p">):</span> <span class="nx">SimState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>This statement declares that a simulator named <code class="prettyprint">energyplus_simulator</code> will be connecting to the server for training. This code snippet binds the previous types to this simulator. To define the training relationship between the simulator and the concept, we must begin by defining the simulator. <code class="prettyprint">energyplus_simulator</code> expects an action of type <code class="prettyprint">SimAction</code> as an input, and it replies with a state of type <code class="prettyprint">SimState</code> as output.</p>

<h2 id="simulator-excerpt">Simulator Excerpt</h2>
<pre class="highlight python tab-python"><code><span class="c"># Excerpt of simulator class from the energyplus_simulator.py file</span>

<span class="k">class</span> <span class="nc">EnergyPlusSimulator</span><span class="p">(</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="s">"""
    Runs the Actuator model for training or prediction by launching it
    against the Ptolemy server above. This uses the Bonsai Simulator
    base class to interface with the BRAIN server.
    """</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ePlus85Actuator</span><span class="p">()</span>
    <span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span><span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">shade</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">episode_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="s">"""
        Callback called when an training episode starts. We use this
        to reset the Ptolemy server and start a new simulation session.
        Returns the initial state.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restartPtolemyServer</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="s">"""
        Callback called  when stepping the simulation. It sends actions to the
        model and returns the state of the simulation to the BRAIN.
        """</span>

        <span class="c"># take the action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">=</span> <span class="n">action</span><span class="p">[</span><span class="s">'shade'</span><span class="p">]</span> <span class="o">*</span> <span class="mf">6.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restartPtolemyServer</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">writeToClient</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">shade</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readFromPtolemyClient</span><span class="p">()</span>

        <span class="c"># you like graphs? WE HAVE GRAPHS. SO MANY GRAPHS.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grapher</span><span class="p">()</span>
            <span class="n">write_graph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>

            <span class="c"># clear old data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[])</span>

        <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reward_function</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">reward</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span>

    <span class="k">def</span> <span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Called at the end of the simulation to output the graph.
        """</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">grapher</span><span class="p">()</span>
        <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">"graph.html"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">readFromPtolemyClient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Utility method used to do the read portion of the exchange
        with the Ptolemy server and client.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">readFromClient</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="c"># save the client input in our graph</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c"># scale some of the values for readability</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">/=</span> <span class="mf">100.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exitFlag</span> <span class="o">!=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">restartPtolemyServer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Used to restart the server and setup the initial state.
        """</span>

        <span class="c"># set some default values for get_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_terminal</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientState</span> <span class="o">=</span> <span class="p">{</span><span class="s">'SolarIrradiation'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c"># close the old connections if they're still open</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># star a new episode</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: starting PtolemyServer"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">PtolemyServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">waitForClient</span><span class="p">()</span>
            <span class="c"># get initial state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readFromPtolemyClient</span><span class="p">()</span>

        <span class="k">except</span> <span class="nb">OSError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: error on restart:"</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">reward_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""
        Calculates the reward for the current state of the simulation
        """</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator: reward_function"</span><span class="p">)</span>

        <span class="c"># largest reward is best reward (maximize)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c"># SolarIrradiation === Shades down === good</span>
            <span class="n">SolarIrradiation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fromClient</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mf">100.</span>

            <span class="c"># sun is down</span>
            <span class="k">if</span> <span class="n">SolarIrradiation</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># shades on</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># shade off</span>

            <span class="c"># sun is out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shade</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c"># shades on</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reward</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c"># shades off</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"EnergyPlusSimulator reward:"</span><span class="p">,</span> <span class="n">reward</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reward</span>
</code></pre>
<p>The full simulator file <em>energyplus_simulator.py</em> for this example is with the rest of the <a href="https://github.com/BonsaiAI/bonsai-sdk/tree/master/samples/energyplus-sample">energyplus-sample code</a> on GitHub.</p>

<p>This is a Python simulator for integrating the EnergyPlus simulator into the Bonsai AI Engine. This <em>energyplus_simulator.py</em> file repeatedly runs the EnergyPlus simulator in the background with new actions sent from the Bonsai AI Engine by passing the state from EnergyPlus to the backend, and the action from the backend back to EnergyPlus.</p>

<p>For more information on the functions inside of this simulator class and how to implement them see the <a href="http://docs.bons.ai/references/library-reference.html">Library Reference</a>.</p>

          <h1 id="simulink-househeat">Simulink Househeat</h1>

<p>Simulink, developed by The MathWorks, is a graphical programming environment for modeling, simulating and analyzing multi-domain dynamical systems.</p>

<p>Please follow our step-by-step tutorial for using Bonsai&rsquo;s Simulink Toolbox to <a href="tutorials/simulink.html"><strong>Train a Simulink Model with Bonsai</strong></a> if you want to use this example. The Inkling File is covered here, and the rest of the necessary steps are covered in that tutorial.</p>

<p>This example shows how to use Simulink to create the thermal model of a house. This system models the outdoor environment, the thermal characteristics of the house, and the house heating system. The objective for the Bonsai AI is to reach the desired temperature.</p>

<h2 id="inkling-file">Inkling File</h2>

<p>Inkling is a declarative, strongly typed programming language specifically designed for artificial intelligence (AI). It abstracts away the world of dynamic AI algorithms that require expertise in machine learning and enables more developers to program AI. Please review our <a href="guides/inkling2-guide.html#overview"><strong>Inkling Guide</strong></a> to learn more about these topics.</p>

<h6 id="types">Types</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">HouseheatState</span> <span class="p">{</span>
    <span class="nx">set_temp</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">room_temp</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">outside_temp</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">dTroom</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">heat_output</span><span class="p">:</span> <span class="k">number</span><span class="p">,</span>
    <span class="nx">dTout</span><span class="p">:</span> <span class="k">number</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">HouseheatState</code> type defines six numeric fields.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">HouseheatAction</span> <span class="p">{</span>
    <span class="nx">heater_on</span><span class="p">:</span> <span class="k">number</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">..</span> <span class="mi">1</span> <span class="k">step</span> <span class="mi">1</span><span class="o">&gt;</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">HouseheatAction</code> type defines a single field  <code class="prettyprint">heater_on</code> with a constrianed numeric range.</p>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">type</span> <span class="nx">HouseheatConfig</span> <span class="p">{</span>
    <span class="nx">outside_phase</span><span class="p">:</span> <span class="k">number</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">HouseheatConfig</code> type defines one field  <code class="prettyprint">outside_phase</code>.</p>

<h6 id="concept-graph">Concept Graph</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">graph</span> <span class="p">(</span><span class="k">input</span><span class="p">:</span> <span class="nx">HouseheatState</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">concept</span> <span class="nx">thermostat</span><span class="p">(</span><span class="k">input</span><span class="p">):</span> <span class="nx">HouseheatAction</span> <span class="p">{</span>
        <span class="k">curriculum</span> <span class="p">{</span>
            <span class="k">source</span> <span class="nx">simulink_sim</span>

            <span class="k">lesson</span> <span class="nx">my_first_lesson</span> <span class="p">{</span>
                <span class="k">constraint</span> <span class="p">{</span>
                    <span class="nx">outside_phase</span><span class="p">:</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>The concept <code class="prettyprint">thermostat</code> has an input of type <code class="prettyprint">HouseheatState</code>. It outputs a value of type <code class="prettyprint">HouseheatAction</code>. This is the AI&rsquo;s next move in the game.</p>

<h6 id="simulator">Simulator</h6>
<pre class="highlight inkling2 tab-inkling2"><code><span class="k">simulator</span> <span class="nx">simulink_sim</span><span class="p">(</span><span class="k">action</span><span class="p">:</span> <span class="nx">HouseheatAction</span><span class="p">,</span> <span class="k">config</span><span class="p">:</span> <span class="nx">HouseheatConfig</span><span class="p">):</span> <span class="nx">HouseheatState</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>The <code class="prettyprint">simulink_sim</code> receives input actions of type <code class="prettyprint">HouseheatAction</code> and configuration information of type <code class="prettyprint">HouseheatConfig</code>. It returns values of type <code class="prettyprint">HouseheatState</code>.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="cpp">cpp</a>
          </div>
      </div>
    </div>

    </div>

  </div>
  <!-- at the end of the BODY -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
  apiKey: '49fa6f01d7ff94a85b9b7434b1c2b7cf',
  indexName: 'bon-sai',
  inputSelector: '#docs-search',
  debug: false // Set debug to true if you want to inspect the dropdown
  });
  </script>
  </body>
</html>
