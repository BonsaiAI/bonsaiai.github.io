


<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>C++ Library Reference - Bonsai</title>
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic"]  }});</script>
    <link href="../stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print.css" rel="stylesheet" media="print" />
	  <link href="../stylesheets/test.css" rel="stylesheet" media="screen" />
    <link href="../favicon.ico" rel="icon" type="image/ico" />
      <script src="../javascripts/all.js"></script>
      <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WVB6MG2');</script>
<!-- End Google Tag Manager -->
      <!-- start Mixpanel -->
<script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
mixpanel.init("91fbf7b68fb2356f91916026f221ddd5", {
    loaded: function(mixpanel) {
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        distinct_id = getParameterByName('refUserId');
        if (distinct_id) {
          mixpanel.identify(distinct_id);
        }
    }
});</script>
<!-- end Mixpanel -->

  </head>

  <body class="references references_cpp-library-reference" data-languages="[]">


	  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WVB6MG2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --> 

  <div id="flex-container">

	<nav id="primary-nav">



	<div id="logo"> <a href="/index.html"><img class="bonsai-logo" src="../images/bonsai-logo.svg"></a></div>

	<label for="drop" class="toggle"><img class="menu-ham" src="../images/menu.svg"></label>
	<input type="checkbox" id="drop" />

	<ul class="menu">

		<li class="header_menu_item "> <a href="../guides/getting-started.html">Quick Start</a></li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-1" class="toggle">Tutorials +</label><a  href="#">Tutorials</a>
			<input type="checkbox" id="drop-1"/>
			<ul id="tutorials">
				<li class=""> <a href="../guides/cli-install-guide.html">Install the CLI</a>  </li>
				<li class=""> <a href="../guides/sdk-install-guide.html">Install the SDK</a>  </li>
				<li class=""> <a href="../tutorials/tutorial1.html">Running Simulations and Writing Inkling</a>  </li>
				<li class=""> <a href="../guides/local-dev-guide.html">Run the Platform Locally</a>  </li>
				<li class=""> <a href="../guides/jupyter-api-guide.html">Use Bonsai's API with Jupyter</a>  </li>
			</ul>
		</li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-2" class="toggle">Guides +</label><a  href="#">Guides</a>
			<input type="checkbox" id="drop-2"/>
			<ul id="guides">
				<li class=""> <a href="../guides/simulation-guide.html">Learn About Simulation Requirements</a>  </li>
				<li class=""> <a href="../guides/inkling-guide.html">Learn the Inkling Language</a>  </li>
				<li class=""> <a href="../guides/machine-teaching.html">Programming Machine Teaching</a>  </li>
				<li class=""> <a href="../guides/ai-engine-guide.html">Understand AI Engine Components</a>  </li>
				<li class=""> <a href="../guides/web-graphs-guide.html">Understand BRAIN Graphs</a>  </li>
			</ul>
		</li>

		<li class="header_menu_item"> <!-- First Tier Drop Down --> <label for="drop-3" class="toggle">References +</label><a  href="#">References</a>
			<input type="checkbox" id="drop-3"/>
			<ul id="references">
				<li class=""> <a href="api-reference.html">API Reference</a>  </li>
				<li class=""> <a href="cli-reference.html">CLI Reference</a>  </li>
				<li class=""> <a href="inkling-reference.html">Inkling Reference</a>  </li>
				<li class=""> <a href="simulator-reference.html">Simulator Reference</a>
				<li class=""> <a href="library-reference.html">Python Library</a>  </li>
				<li class="selected"> <a href="cpp-library-reference.html">C++ Library</a>  </li>
				
			</ul> 
		</li>

		<li class="header_menu_item "> <a href="../examples.html">Examples</a></li>

		<li>
			<input type="search" id="docs-search" placeholder="Search Bonsai Docs">
		</li>


	</ul>

</nav>


	<div id="main-wrapper">

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">

        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div class="page-title">C++ Library Reference</div>
      <div id="toc">
      </div>

			 
<ul class="toc-footer">

<li><a href='https://bons.ai'>Bonsai Home</a></li>
<li><a href='https://beta.bons.ai'>BRAIN Dashboard</a></li>
<li><a href='https://github.com/BonsaiAI/slate'>Contribute to the Docs</a></li>
<li><a href='https://bons.ai/get-started'>Apply for Bonsai Platform Preview</a></li>
<li><a href="/releases.html">Product Release Notes</a></li>
<li><a href='https://bons.ai/contact-us#contact-page-form'>Contact Us</a></li>

</ul>


	   <div class="cc-bottom">
	
	<div class="toc-footer bottom cc-info">

		<a href='https://creativecommons.org/licenses/by-sa/4.0/' class="cc-icon-width" >
			<svg class="cc" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
			viewBox="0 0 70.7 13.4" style="enable-background:new 0 0 70.7 13.4;" xml:space="preserve">

				<g>

				<g>
				<circle class="st0" cx="6.8" cy="6.7" r="6.1"/>
				<path d="M6.7,0c1.9,0,3.5,0.7,4.8,2c0.6,0.6,1.1,1.4,1.4,2.2c0.3,0.8,0.5,1.7,0.5,2.6c0,0.9-0.2,1.8-0.5,2.6
				c-0.3,0.8-0.8,1.5-1.4,2.1c-0.7,0.6-1.4,1.1-2.2,1.5c-0.8,0.3-1.7,0.5-2.6,0.5S5,13.3,4.2,12.9c-0.8-0.3-1.5-0.8-2.2-1.5
				s-1.1-1.4-1.5-2.2S0,7.6,0,6.7C0,5.8,0.2,5,0.5,4.2S1.3,2.6,2,2C3.3,0.7,4.8,0,6.7,0z M6.7,1.2c-1.5,0-2.8,0.5-3.9,1.6
				C2.3,3.4,1.9,4,1.6,4.6C1.4,5.3,1.2,6,1.2,6.7c0,0.7,0.1,1.4,0.4,2.1c0.3,0.7,0.7,1.3,1.2,1.8c0.5,0.5,1.1,0.9,1.8,1.2
				c0.7,0.3,1.4,0.4,2.1,0.4c0.7,0,1.4-0.1,2.1-0.4c0.7-0.3,1.3-0.7,1.8-1.2c1-1,1.6-2.3,1.6-3.9c0-0.7-0.1-1.4-0.4-2.1
				c-0.3-0.7-0.7-1.3-1.2-1.8C9.5,1.8,8.2,1.2,6.7,1.2z M6.6,5.6L5.7,6.1C5.6,5.9,5.5,5.7,5.4,5.6C5.3,5.6,5.1,5.5,5,5.5
				c-0.6,0-0.9,0.4-0.9,1.2c0,0.4,0.1,0.6,0.2,0.9C4.5,7.8,4.7,7.9,5,7.9c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4C6.5,8.1,6.2,8.3,5.9,8.5
				c-0.3,0.2-0.7,0.3-1,0.3c-0.6,0-1.1-0.2-1.5-0.6C3.1,7.9,2.9,7.4,2.9,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6
				C5.7,4.6,6.3,5,6.6,5.6z M10.5,5.6L9.6,6.1C9.5,5.9,9.4,5.7,9.3,5.6C9.1,5.6,9,5.5,8.9,5.5C8.3,5.5,8,5.9,8,6.7
				c0,0.4,0.1,0.6,0.2,0.9c0.2,0.2,0.4,0.3,0.7,0.3c0.4,0,0.7-0.2,0.8-0.6l0.8,0.4c-0.2,0.3-0.4,0.6-0.7,0.8c-0.3,0.2-0.7,0.3-1,0.3
				c-0.6,0-1.1-0.2-1.5-0.6C7,7.9,6.8,7.4,6.8,6.7c0-0.6,0.2-1.1,0.6-1.5c0.4-0.4,0.8-0.6,1.4-0.6C9.6,4.6,10.2,5,10.5,5.6z"/>
				</g>

				</g>
			</svg>
		</a>
		
		<a href='https://creativecommons.org/licenses/by-sa/4.0/'>Content:
		CC-BY-SA </a>
		
	</div>

</div>

    </div>

    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="library-overview">Library Overview</h1>

<p>The Bonsai libraries known as <code class="prettyprint">libbonsai</code> (C++) and <code class="prettyprint">bonsai_ai</code> (Python) wrap the Bonsai API to simplify the process of building simulators in C++ and Python programming languages. The C++ library is current in beta and not 100% on feature parity with the Python library. This library is compatible with Windows 7/10, macOS, and Linux.</p>

<p>When the AI Engine trains with the simulator it works in a loop. First, the simulator connects and registers itself with the AI Engine. Then, the simulator sends the AI Engine a state and the value of any objectives or rewards; next, the AI Engine replies with an action. The simulator then uses this action to advance the simulation and compute a new state. This “send state, receive action” process is repeated until training stops. At any time the AI engine may stop, reconfigure, and reset the simulator. After doing so it will either restart this training loop or stop training. A single state, action, next state, loop is sometimes referred to as an “iteration”.</p>

<p>The <code class="prettyprint">Config</code> object has a built in command line parser which can be used to override the local running environment. It comes with a set of standard switches which can be viewed with the <code class="prettyprint">--help</code> option. The current default configuration is read from environment variables, a <code class="prettyprint">~/.bonsai</code> configuration file in the user’s home directory, a <code class="prettyprint">./.bonsai</code> and a <code class="prettyprint">./.brains</code> configuration file in the current working directory, command line options, and programmatically in code.</p>

          <h1 id="brain-class">Brain Class</h1>

<p>Manages a BRAIN instance, talks with the server backend, and contains
information about the BRAIN state. In future versions will be used to upload
and download Inkling to and from the BRAIN on the server.</p>

<p>Requires a configuration and a BRAIN name. The BRAIN name can be set in
several places, and there is an order of what takes precedence over the other as follows:</p>

<p>Brain() &gt;&gt; &ndash;brain &gt;&gt; .brains &gt;&gt; .bonsai[profile] &gt;&gt; .bonsai[DEFAULT] &gt;&gt; env[BONSAI_TRAIN_BRAIN]</p>

<p>such that &ldquo;&gt;&gt;&rdquo; indicates a decreasing order of precedence. Note that failure to set
BRAIN name in at least one of these places will result in a friendly error.</p>

<h2 id="brain-config-name">Brain(config, name)</h2>
<pre class="highlight cpp tab-cpp"><code><span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Brain</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Creates a local object for interacting with an existing BRAIN on the server.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">config</code></td>
<td>Object returned by previously created <code class="prettyprint">Bonsai::Config</code>.</td>
</tr>
<tr>
<td><code class="prettyprint">name</code></td>
<td>BRAIN name as specified on the server. If name is empty, the BRAIN name in <code class="prettyprint">config</code> is used instead.</td>
</tr>
</tbody></table>

<h2 id="update">update()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">brain</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</code></pre>
<p>Refreshes description, status, and other information with the current state of the BRAIN on the server.
Called by default when constructing a new Brain object.</p>

<h2 id="string-name">string name()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the name of the BRAIN as specified when it was created.</p>

<h2 id="string-description">string description()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">description</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the user-provided description for the BRAIN.</p>

<h2 id="int-version">int version()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">version</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the current version number of the BRAIN.</p>

<h2 id="int-latest_version">int latest_version()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">latest_version</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns latest version number of the BRAIN.</p>

<h2 id="config-config">Config config()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">config</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the configuration used to locate this BRAIN.</p>

<h2 id="operator-ostream-brain">operator&lt;&lt;(ostream, brain)</h2>

<p>Prints out a representation of Brain that is useful for debugging.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">ostream</code></td>
<td>A std C++ stream operator.</td>
</tr>
<tr>
<td><code class="prettyprint">brain</code></td>
<td>A <code class="prettyprint">bonsai::Brain</code> object to print out.</td>
</tr>
</tbody></table>

          <h1 id="config-class">Config Class</h1>

<blockquote>
<p>Example <code class="prettyprint">~/.bonsai</code> file</p>
</blockquote>
<pre class="highlight ini tab-ini"><code><span class="nn">[DEFAULT]</span>
<span class="py">username</span> <span class="p">=</span> <span class="s">admin</span>
<span class="py">accesskey</span> <span class="p">=</span> <span class="s">None</span>
<span class="py">profile</span> <span class="p">=</span> <span class="s">dev</span>

<span class="nn">[dev]</span>
<span class="py">url</span> <span class="p">=</span> <span class="s">http://localhost:5000</span>
<span class="py">username</span> <span class="p">=</span> <span class="s">admin</span>
<span class="py">accesskey</span> <span class="p">=</span> <span class="s">00000000-1111-2222-3333-000000000001</span>
</code></pre>
<p>Manages Bonsai configuration environments.
Config files can be specified in the user home directory, <code class="prettyprint">~/.bonsai</code>,
or in a local directory. Configuration parameters can also be parsed from
the command line.</p>

<p>The <code class="prettyprint">profile</code> key can be used to switch between different profiles in
one configuration file.</p>

<h2 id="config-profile">Config(profile)</h2>
<pre class="highlight cpp tab-cpp"><code><span class="cp">#include &lt;bonsai.hpp&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="p">();</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">config</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Constructs a default configuration.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">profile</code></td>
<td>Optional <code class="prettyprint">.bonsai</code> profile name. Will use the DEFAULT profile if not specified.</td>
</tr>
</tbody></table>

<p>Configurations are stored in <code class="prettyprint">~/.bonsai</code> and <code class="prettyprint">./.bonsai</code> configuration files.
The local configuration file overrides settings in the configuration file in the user home directory.</p>

<h2 id="config-argc-argv-profile">Config(argc, argv, profile)</h2>
<pre class="highlight cpp tab-cpp"><code><span class="cp">#include &lt;bonsai.hpp&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">config</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>Constructs a config by looking in the configuration files and parsing the command line arguments.
To see the list of command line arguments, pass in the <code class="prettyprint">--help</code> flag.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">argc</code></td>
<td>As passed to main(). (C++)</td>
</tr>
<tr>
<td><code class="prettyprint">argv</code></td>
<td>As passed to main(). (C++/Python)</td>
</tr>
<tr>
<td><code class="prettyprint">profile</code></td>
<td>Optional <code class="prettyprint">.bonsai</code> profile name. Will use the DEFAULT profile if not specified.</td>
</tr>
</tbody></table>

<p>Unrecognized arguments will be ignored.</p>

<h2 id="accesskey">accesskey()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">accesskey</span><span class="p">()</span> <span class="o">==</span> <span class="s">"00000000-1111-2222-3333-000000000001"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_accesskey</span><span class="p">(</span><span class="s">"00000000-1111-2222-3333-000000000001"</span><span class="p">);</span>
</code></pre>
<p>Server authentication token.
Obtained from the bonsai server. You need to set it in your config.</p>

<h2 id="username">username()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">username</span><span class="p">()</span> <span class="o">==</span> <span class="s">"alice"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_username</span><span class="p">(</span><span class="s">"alice"</span><span class="p">);</span>
</code></pre>
<p>Account user name.
The account you signed up with.</p>

<h2 id="url">url()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">url</span><span class="p">()</span> <span class="o">==</span> <span class="s">"https://api.bons.ai"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_url</span><span class="p">(</span><span class="s">"https://api.bons.ai"</span><span class="p">);</span>
</code></pre>
<p>Server URL.
Address and port number of the bonsai server. Normally you should not need to change this.</p>

<h2 id="proxy">proxy()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">proxy</span><span class="p">()</span> <span class="o">==</span> <span class="s">"myproxy:5000"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_proxy</span><span class="p">(</span><span class="s">"myproxy:5000"</span><span class="p">);</span>
</code></pre>
<p>Proxy Server.
Address and port number of the proxy server to connect through.</p>

<h2 id="brain">brain()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">brain</span><span class="p">()</span> <span class="o">==</span> <span class="s">"scarecrow"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_brain</span><span class="p">(</span><span class="s">"scarecrow"</span><span class="p">);</span>
</code></pre>
<p>BRAIN name.
Name of the BRAIN on the server.</p>

<h2 id="predict">predict()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">predict</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_predict</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre>
<p>Simulator mode.
The mode in which simulators will run. True if running for prediction, false for training.</p>

<h2 id="brain_version">brain_version()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">brain_version</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_brain_version</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre>
<p>BRAIN version.
The version of the brain to use when running for prediction. Set to 0 to use latest version.</p>

<h2 id="record_file">record_file()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">record_file</span><span class="p">()</span> <span class="o">==</span> <span class="s">"foobar.json"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_record_file</span><span class="p">(</span><span class="s">"foobar.json"</span><span class="p">);</span>
</code></pre>
<p>This property defines the destination for log recording. Additionally, the format for log recording is inferred from the file extension. Currently supported options are <code class="prettyprint">json</code> and <code class="prettyprint">csv</code>. Missing file extension or use of an unsupported extension will result in runtime errors.</p>

<h2 id="record_enabled">record_enabled()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">record_enabled</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">set_record_enabled</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre>
<h2 id="record_format">record_format()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_config</span><span class="p">.</span><span class="n">record_file</span><span class="p">()</span> <span class="o">==</span> <span class="s">"foobar.json"</span><span class="p">;</span>
<span class="n">my_config</span><span class="p">.</span><span class="n">record_format</span><span class="p">()</span> <span class="o">==</span> <span class="s">"json"</span><span class="p">;</span>
</code></pre>
<p><strong>Note:</strong> This property cannot be set directly. It reflects the file extension of the currently configured <code class="prettyprint">record_file</code>. <code class="prettyprint">json</code> or <code class="prettyprint">csv</code> are valid.</p>

<h2 id="operator-ostream-config">operator&lt;&lt;(ostream, config)</h2>

<p>Will print out a representation of Config that is useful for debugging.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">ostream</code></td>
<td>A std c++ stream operator.</td>
</tr>
<tr>
<td><code class="prettyprint">config</code></td>
<td>A <code class="prettyprint">bonsai::Config</code> object to print.</td>
</tr>
</tbody></table>

          <h1 id="simulator-class">Simulator Class</h1>

<blockquote>
<p><img src="../images/simulator_state.svg" alt="Simulator state image" /></p>
</blockquote>

<p>This class is used to interface with the server while training or running predictions against
a <strong>BRAIN</strong>. It is an abstract base class, and to use it a developer must create a subclass.</p>

<p>The <code class="prettyprint">Simulator</code> class is closely related to the <strong>Inkling</strong> file that is associated with
the <strong>BRAIN</strong>. The name used to construct <code class="prettyprint">Simulator</code> must match the name of the simulator
in the <em>Inkling</em> file.</p>

<p>There are two main methods that you must override, <code class="prettyprint">episode_start</code> and <code class="prettyprint">simulate</code>. The diagram
demonstrates how these are called during training. Optionally, one may also override
<code class="prettyprint">episode_finish</code>, which is called at the end of an episode.</p>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">brain</code></td>
<td>The simulators Brain object.</td>
</tr>
<tr>
<td><code class="prettyprint">name</code></td>
<td>The simulators name.</td>
</tr>
<tr>
<td><code class="prettyprint">objective_name</code></td>
<td>The name of the current objective for an episode.</td>
</tr>
<tr>
<td><code class="prettyprint">episode_reward</code></td>
<td>Cumulative reward for this episode so far.</td>
</tr>
<tr>
<td><code class="prettyprint">episode_count</code></td>
<td>Number of completed episodes since sim launch.</td>
</tr>
<tr>
<td><code class="prettyprint">episode_rate</code></td>
<td>Episodes per second.</td>
</tr>
<tr>
<td><code class="prettyprint">iteration_count</code></td>
<td>Number of iterations for the current episode.</td>
</tr>
<tr>
<td><code class="prettyprint">iteration_rate</code></td>
<td>Iterations per second.</td>
</tr>
</tbody></table>

<h2 id="simulator-brain-name">Simulator(brain, name)</h2>

<blockquote>
<p>Example Inkling:</p>
</blockquote>
<pre class="highlight inkling tab-inkling"><code><span class="k">simulator</span> <span class="nx">my_simulator</span><span class="p">(</span><span class="nx">Config</span><span class="p">)</span>
    <span class="k">action</span> <span class="p">(</span><span class="nx">Action</span><span class="p">)</span>
    <span class="k">state</span> <span class="p">(</span><span class="nx">State</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
<blockquote>
<p>Example code:</p>
</blockquote>
<pre class="highlight cpp tab-cpp"><code><span class="k">class</span> <span class="nc">MySimulator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Simulator</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">BasicSimulator</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Brain</span><span class="o">&gt;</span> <span class="n">brain</span><span class="p">,</span> <span class="n">string</span> <span class="n">name</span><span class="p">)</span>
        <span class="o">:</span> <span class="n">Simulator</span><span class="p">(</span><span class="n">move</span><span class="p">(</span><span class="n">brain</span><span class="p">),</span> <span class="n">move</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// your simulator init code goes here.
</span>        <span class="p">}</span>

    <span class="kt">void</span> <span class="n">episode_start</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span>
        <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">initial_state</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
            <span class="c1">// your simulation episode reset/init code.
</span>        <span class="p">}</span>

    <span class="kt">void</span> <span class="n">simulate</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
        <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span>
        <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span>
        <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span>
            <span class="c1">// your simulation stepping code.
</span>        <span class="p">}</span>

    <span class="kt">void</span> <span class="n">episode_finish</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span>
            <span class="c1">// your post-episode code.
</span>        <span class="p">}</span>
<span class="p">};</span>

<span class="p">...</span>

<span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Brain</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="n">MySimulator</span> <span class="n">sim</span><span class="p">(</span><span class="n">brain</span><span class="p">,</span> <span class="s">"my_simulator"</span><span class="p">);</span>

<span class="p">...</span>

</code></pre>
<p>Serves as a base class for running simulations. You should create a subclass
of Simulator and implement the <code class="prettyprint">episode_start</code> and <code class="prettyprint">simulate</code> callbacks.</p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">brain</code></td>
<td>A Brain object for the BRAIN you wish to train against.</td>
</tr>
<tr>
<td><code class="prettyprint">name</code></td>
<td>The name of simulator as specified in the Inkling for the BRAIN.</td>
</tr>
</tbody></table>

<h2 id="brain-brain">Brain brain()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sim</span><span class="p">.</span><span class="n">brain</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the BRAIN being used for this simulation.</p>

<h2 id="string-name">string name()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Starting "</span> <span class="o">&lt;&lt;</span> <span class="n">sim</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</code></pre>
<p>Returns the simulator name that was passed in when constructed.</p>

<h2 id="bool-predict">bool predict()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">simulate</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
                    <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">predict</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// calculate reward...
</span>    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<p>Returns a value indicating whether the simulation is set up to run in predict mode or training mode.</p>

<h2 id="string-objective_name">string objective_name()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">episode_start</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span>
                                <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">initial_state</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">objective_name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<p>Property accessor that returns the name of the current objective from Inkling.
The objective may be updated before <code class="prettyprint">episode_start</code> is called. When running
for prediction and during start up, objective will return an empty std::string.</p>

<h2 id="episode_start-parameters-initial_state">episode_start(parameters, initial_state)</h2>

<blockquote>
<p>Example Inkling:</p>
</blockquote>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">Config</span>
    <span class="kr">UInt8</span> <span class="nx">start_angle</span>
<span class="k">end</span>

<span class="k">schema</span> <span class="nx">State</span>
    <span class="kr">Float32</span> <span class="nx">angle</span><span class="p">,</span>
    <span class="kr">Float32</span> <span class="nx">velocity</span>
<span class="k">end</span>
</code></pre>
<blockquote>
<p>Example code:</p>
</blockquote>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">episode_start</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span>
                                <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">initial_state</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// training params are only passed in during training
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">predict</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">objective_name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">get_float32</span><span class="p">(</span><span class="s">"start_angle"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">initial_state</span><span class="p">.</span><span class="n">set_float32</span><span class="p">(</span><span class="s">"velocity"</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
    <span class="n">initial_state</span><span class="p">.</span><span class="n">set_float32</span><span class="p">(</span><span class="s">"angle"</span><span class="p">,</span>    <span class="n">angle</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">parameters</code></td>
<td>InklingMessage of episode initialization parameters as defined in inkling. <code class="prettyprint">parameters</code> will be populated if a training session is running.</td>
</tr>
<tr>
<td><code class="prettyprint">initial_state</code></td>
<td>Output InklingMessage. The subclasser should populate this message with the initial state of the simulation.</td>
</tr>
</tbody></table>

<p>This callback passes in a set of initial parameters and expects an initial state in return
for the simulator. Before this callback is called, the property <code class="prettyprint">objective_name</code> will be
updated to reflect the current objective for this episode.</p>

<p>This call is where a simulation should be reset for the next round.</p>

<p>The default implementation will throw an exception.</p>

<h2 id="simulate-action-state-reward-terminal">simulate(action, state, reward, terminal)</h2>

<blockquote>
<p>Example Inkling:</p>
</blockquote>
<pre class="highlight inkling tab-inkling"><code><span class="k">schema</span> <span class="nx">Action</span>
    <span class="kr">Int8</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}</span> <span class="nx">delta</span>
<span class="k">end</span>
</code></pre>
<blockquote>
<p>Example code:</p>
</blockquote>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">simulate</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
                           <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span> <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">velocity</span> <span class="o">-</span> <span class="n">action</span><span class="p">.</span><span class="n">get_int8</span><span class="p">(</span><span class="s">"delta"</span><span class="p">);</span>
    <span class="n">terminal</span> <span class="o">=</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">);</span>

    <span class="c1">// reward is only needed during training.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">predict</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">reward_for_objective</span><span class="p">(</span><span class="n">objective_name</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="n">state</span><span class="p">.</span><span class="n">set_float32</span><span class="p">(</span><span class="s">"velocity"</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
    <span class="n">state</span><span class="p">.</span><span class="n">set_float32</span><span class="p">(</span><span class="s">"angle"</span><span class="p">,</span>    <span class="n">angle</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">action</code></td>
<td>Input InklingMessage of action to be taken as defined in inkling.</td>
</tr>
<tr>
<td><code class="prettyprint">state</code></td>
<td>Output InklingMessage. Should be populated with the current simulator state.</td>
</tr>
<tr>
<td><code class="prettyprint">reward</code></td>
<td>Output reward value as calculated based upon the objective.</td>
</tr>
<tr>
<td><code class="prettyprint">terminal</code></td>
<td>Output terminal state. Set to true if the simulator is in a terminal state.</td>
</tr>
</tbody></table>

<p>This callback steps the simulation forward by a single step. It passes in
the <code class="prettyprint">action</code> to be taken, and expects the resulting <code class="prettyprint">state</code>, <code class="prettyprint">reward</code> for the current
<code class="prettyprint">objective</code>, and a <code class="prettyprint">terminal</code> flag used to signal the end of an episode. Note that an
episode may be reset prematurely by the backend during training.</p>

<p>For a multi-lesson curriculum, the <code class="prettyprint">objective_name</code> will change from episode to episode.
In this case ensure that the simulator is returning the correct reward for the
different lessons.</p>

<p>Returning <code class="prettyprint">true</code> for the <code class="prettyprint">terminal</code> flag signals the start of a new episode.</p>

<p>The default implementation will throw an exception.</p>

<h2 id="bool-run">bool run()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">MySimulator</span> <span class="n">sim</span><span class="p">(</span><span class="n">brain</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">predict</span><span class="p">())</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Predicting against "</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" version "</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">version</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Training "</span> <span class="o">&lt;&lt;</span> <span class="n">brain</span><span class="p">.</span><span class="n">name</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span> <span class="n">sim</span><span class="p">.</span><span class="n">run</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>
<p>Main loop call for driving the simulation. Returns <code class="prettyprint">false</code> when the
simulation has finished or halted.</p>

<p>The client should call this method in a <code class="prettyprint">while</code> loop until it returns <code class="prettyprint">false</code>.
To run for prediction, <code class="prettyprint">brain()-&gt;config()-&gt;predict()</code> must return <code class="prettyprint">true</code>.</p>

<h2 id="episode_finish">episode_finish()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">episode_finish</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="err">'</span><span class="n">Episode</span><span class="o">:</span> <span class="err">'</span> <span class="o">&lt;&lt;</span> <span class="n">episode_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="err">'</span> <span class="n">reward</span><span class="o">:</span><span class="err">'</span> <span class="o">&lt;&lt;</span> <span class="n">episode_reward</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>This callback is called at the end of each episode. You can use it to log
out statistical information, or perform post episode cleanup.</p>

<h2 id="record_file">record_file()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">my_sim</span><span class="p">.</span><span class="n">record_file</span><span class="p">()</span> <span class="o">==</span> <span class="s">"/path/to/foobar.json"</span><span class="p">;</span>
<span class="n">my_sim</span><span class="p">.</span><span class="n">set_record_file</span><span class="p">(</span><span class="s">"/path/to/barfoo.json"</span><span class="p">);</span>

<span class="n">my_sim</span><span class="p">.</span><span class="n">record_file</span><span class="p">()</span> <span class="o">==</span> <span class="s">"/path/to/foobar.csv"</span><span class="p">;</span>
<span class="n">my_sim</span><span class="p">.</span><span class="n">set_record_file</span><span class="p">(</span><span class="s">"/path/to/barfoo.csv"</span><span class="p">);</span>
</code></pre>
<p>Getter and setter for analytics recording file.</p>

<p>When a new record file is set, the previous file will be closed immediately. Subsequent log lines will be written to the new file.</p>

<h2 id="enable_keys-keys-prefix-none">enable_keys(keys, prefix=None)</h2>

<p>This function adds the given keys to the log schema for this writer.
If one is provided, the prefix will be prepended to those keys and
they will appear as such in the resulting logs.
If recording is not enabled, this method has no effect.</p>

<p>You should enable any keys you expect to see in the logs. If you
attempt to insert objects containing keys which have not been
enabled, those keys will be silently ignored.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Brain</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
    <span class="n">MySim</span> <span class="n">sim</span><span class="p">(</span><span class="n">brain</span><span class="p">);</span>
    <span class="n">sim</span><span class="p">.</span><span class="n">enable_keys</span><span class="p">({</span><span class="s">"foo"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">});</span>
    <span class="n">sim</span><span class="p">.</span><span class="n">enable_keys</span><span class="p">({</span><span class="s">"baz"</span><span class="p">},</span> <span class="s">"qux"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">keys</code></td>
<td>A list/vector of strings to include as keys in log entries for this simulator.</td>
</tr>
<tr>
<td><code class="prettyprint">prefix</code></td>
<td>A <code class="prettyprint">std::string</code> used as a subdomain for the given <code class="prettyprint">keys</code>. Entries will appear as <code class="prettyprint">&lt;prefix&gt;.&lt;key&gt;</code> for each <code class="prettyprint">key</code> in <code class="prettyprint">keys</code>. Defaults to empty string.</td>
</tr>
</tbody></table>

<h2 id="record_append-key-value-prefix">record_append(key, value, prefix=&ldquo;&rdquo;)</h2>

<p>Adds the given key (prepended by <code class="prettyprint">prefix</code>, if provided) and value to the current log entry. If the specified
key is not enabled or recording is not enabled, this method has no effect.</p>

<p>The following <code class="prettyprint">value</code> types are supported:
- <code class="prettyprint">int64_t</code>
- <code class="prettyprint">size_t</code>
- <code class="prettyprint">double</code>
- <code class="prettyprint">std::string</code>
- <code class="prettyprint">bool</code></p>

<p><strong>Note:</strong> The template specializations in the following snippet are included for completeness. If the <code class="prettyprint">value</code> parameter is of one of the supported types, the correct specialization will be deduced by the compiler.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">config</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">bonsai</span><span class="o">::</span><span class="n">Config</span><span class="o">&gt;</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="n">config</span><span class="p">.</span><span class="n">set_recording_enabled</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
    <span class="n">config</span><span class="p">.</span><span class="n">set_record_filie</span><span class="p">(</span><span class="s">"foobar.json"</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">brain</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Brain</span><span class="o">&gt;</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
    <span class="n">MySim</span> <span class="n">sim</span><span class="p">(</span><span class="n">brain</span><span class="p">);</span>
    <span class="n">sim</span><span class="p">.</span><span class="n">enable_keys</span><span class="p">({</span><span class="s">"foo"</span><span class="p">,</span> <span class="s">"bar"</span><span class="p">,</span> <span class="s">"oof"</span><span class="p">,</span> <span class="s">"rab"</span><span class="p">});</span>
    <span class="n">sim</span><span class="p">.</span><span class="n">enable_keys</span><span class="p">({</span><span class="s">"baz"</span><span class="p">},</span> <span class="s">"qux"</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">sim</span><span class="p">.</span><span class="n">run</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="o">-</span><span class="mi">23</span><span class="p">);</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"bar"</span><span class="p">,</span> <span class="mi">123</span><span class="p">);</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"oof"</span><span class="p">,</span> <span class="mf">.023</span><span class="p">);</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"rab"</span><span class="p">,</span> <span class="s">"foobar"</span><span class="p">);</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"baz"</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">"qux"</span><span class="p">);</span>
        <span class="n">sim</span><span class="p">.</span><span class="n">record_append</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"nope"</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">key</code></td>
<td>A <code class="prettyprint">std::string</code> used as an index into the current log entry.</td>
</tr>
<tr>
<td><code class="prettyprint">value</code></td>
<td>The value to add under <code class="prettyprint">&lt;prefix&gt;.&lt;key&gt;</code>. May be any of <code class="prettyprint">int64_t</code>, <code class="prettyprint">size_t</code>, <code class="prettyprint">double</code>, <code class="prettyprint">std::string</code>, or <code class="prettyprint">bool</code></td>
</tr>
<tr>
<td><code class="prettyprint">prefix</code></td>
<td>String prefix for <code class="prettyprint">key</code>. Keys should be enabled and added with the same prefix.</td>
</tr>
</tbody></table>

<h2 id="close">close()</h2>

<p>Close the internal websocket.</p>

<h2 id="operator-ostream-simulator">operator&lt;&lt;(ostream, simulator)</h2>

<p>Prints out a representation of Simulator that is useful for debugging.</p>

<p><strong>Note:</strong> Used in C++ only. For python, use <code class="prettyprint">print(simulator)</code></p>

<table><thead>
<tr>
<th>Argument</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">ostream</code></td>
<td>A std c++ stream operator.</td>
</tr>
<tr>
<td><code class="prettyprint">simulator</code></td>
<td>A bonsai::Simulator to print out.</td>
</tr>
</tbody></table>

          <h1 id="logging-class">Logging Class</h1>

<p>Runtime logging is accomplished using the <code class="prettyprint">BONSAI_LOG</code> macro; <code class="prettyprint">BONSAI_LOG</code> may be invoked
freely on log domains of your choosing, but the accompanying messages will only be printed if
a given domain has been enabled either through command line flags (see <code class="prettyprint">bonsai::Config</code>) or
through <code class="prettyprint">bonsai::logging::set_enabled</code>.</p>

<p>Consumers of <code class="prettyprint">bonsai::logging</code> may enable a custom handler for <code class="prettyprint">BONSAI_LOG</code> via
<code class="prettyprint">logging::set_handler</code>. By default, logs print to <code class="prettyprint">stderr</code>.</p>

<p>Additionally, use <code class="prettyprint">logging::set_use_colors</code> to enable/disable ASCII colors in log output.</p>
<pre class="highlight cpp tab-cpp"><code><span class="k">using</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MySimulator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Simulator</span> <span class="p">{</span>
<span class="p">...</span>
    <span class="kt">void</span> <span class="n">simulate</span><span class="p">(</span><span class="k">const</span> <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">action</span><span class="p">,</span>
                   <span class="n">bonsai</span><span class="o">::</span><span class="n">InklingMessage</span><span class="o">&amp;</span> <span class="n">state</span><span class="p">,</span>
                   <span class="kt">float</span><span class="o">&amp;</span> <span class="n">reward</span><span class="p">,</span> <span class="kt">bool</span><span class="o">&amp;</span> <span class="n">terminal</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">BONSAI_LOG</span><span class="p">(</span><span class="n">foobar</span><span class="p">,</span> <span class="s">"things ("</span> <span class="o">&lt;&lt;</span> <span class="n">reward</span> <span class="o">&lt;&lt;</span> <span class="s">") stuff"</span><span class="p">);</span> <span class="c1">// logged
</span>        <span class="n">BONSAI_LOG</span><span class="p">(</span><span class="n">barfoo</span><span class="p">,</span> <span class="s">"things ("</span> <span class="o">&lt;&lt;</span> <span class="n">reward</span> <span class="o">&lt;&lt;</span> <span class="s">") stuff"</span><span class="p">);</span> <span class="c1">// not logged
</span>        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">...</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_enabled</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_enabled</span><span class="p">(</span><span class="s">"foobar"</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<h2 id="bonsai_log-domain-message">BONSAI_LOG(domain, message)</h2>

<p><code class="prettyprint">BONSAI_LOG</code> is a preprocessor macro defined in <code class="prettyprint">logging.hpp</code>. It encapsulates various calls into
the <code class="prettyprint">logging</code> singleton and performs the necessary domain checks and I/O procedures without the
overhead of an additional function call.</p>
<pre class="highlight cpp tab-cpp"><code><span class="kt">void</span> <span class="n">MySimulator</span><span class="o">::</span><span class="n">simulate</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="n">BONSAI_LOG</span><span class="p">(</span><span class="n">foobar</span><span class="p">,</span> <span class="s">"my hovercraft has "</span> <span class="o">&lt;&lt;</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="s">"eels"</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</code></pre>
<p>The log domain should not include quotes. It will be quoted into a string literal at preprocessor time.</p>

<p>Similarly, the message will be interpolated into an expression of the form <code class="prettyprint">std::cerr &lt;&lt; X &lt;&lt; std::endl;</code>. As such, <code class="prettyprint">message</code> can be any expression which produces syntactically correct C++  when substituted for X in an expression of that form.</p>

<h2 id="enabled">enabled()</h2>

<p>Global switch to enable/disable logging.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">enabled</span><span class="p">()</span> <span class="o">==</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_enabled</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre>
<p>Individual switches to enable/disable specific domains.</p>
<pre class="highlight cpp tab-cpp"><code><span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">enabled</span><span class="p">(</span><span class="s">"foobar"</span><span class="p">)</span> <span class="o">==</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_enabled</span><span class="p">(</span><span class="s">"foobar"</span><span class="p">);</span>
</code></pre>
<h2 id="enabled_all">enabled_all()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">enabled_all</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_enable_all</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre>
<p>Switch to enable/disable verbose logging.</p>

<h2 id="use_colors">use_colors()</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">use_colors</span><span class="p">()</span> <span class="o">==</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_use_colors</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</code></pre>
<p>Switch to enable/disable ASCII colors in log output. Enabled by default.</p>

<h2 id="set_handler-functionvoid-stringstream">set_handler(function&lt;void(stringstream&amp;)&gt;)</h2>
<pre class="highlight cpp tab-cpp"><code><span class="n">bonsai</span><span class="o">::</span><span class="n">logging</span><span class="o">::</span><span class="n">log</span><span class="p">().</span><span class="n">set_handler</span><span class="p">([](</span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="o">&amp;</span> <span class="n">ss</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">});</span>
</code></pre>
<p>Set a custom handler for <code class="prettyprint">BONSAI_LOG</code>. Instead of streaming directly to 
<code class="prettyprint">std::cerr</code>, each log line will be passed to this custom handler in the form of a <code class="prettyprint">std::stringstream</code>.</p>

          <h1 id="event-class">Event Class</h1>

<p>Internally, the Bonsai library uses a state machine to drive activity in user
code (i.e. advancing and recording simulator state, resetting a simulator, etc).
State transfer is driven primarily by a websocket-based messaging protocol
shared between the library and the Bonsai AI platform. For your convenience,
the details of this protocol have been hidden behind a pair of API&rsquo;s, one based
on callbacks in <code class="prettyprint">bonsai_ai.Simulator</code> and the other event driven.</p>

<p>Filling out the callbacks in <code class="prettyprint">bonsai_ai.Simulator</code> and relying on
<code class="prettyprint">Simulator.run</code> to invoke them at the appropriate time will be sufficient for
many use cases. For example, if you have a simulator which can be advanced,
reset, and observed in a synchronous manner from Python or C++ code, your
application is likely amenable to our callback API. However, if, for example,
your simulator is free running and communicates with your application code
asynchronously, your application will likely need to employ the event driven
API described below.</p>

<p>In the <strong>event-driven mode of operation</strong>, you application code should implement
its own run loop by requesting successive events from the Bonsai library and
handling them in a way that is appropriate to your particular simulation or
deployment architecture. For example, if your simulator invokes callbacks into
your code and is reset in response to some outgoing signal (i.e. not via a
method call), you might respond to an <code class="prettyprint">EpisodeStartEvent</code> by setting the
appropriate flag, returning control to the simulator, and returning the
resulting state to the Bonsai platform the next time your callback gets invoked.</p>

<h3 id="enum-class-type">enum class Type</h3>
<pre class="highlight cpp tab-cpp"><code><span class="k">auto</span> <span class="n">event</span> <span class="o">=</span> <span class="n">get_next_event</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">Type</span><span class="o">::</span><span class="n">Episode_Start</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">es_E</span> <span class="o">=</span> <span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">EpisodeStartEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">initial_properties</span> <span class="o">=</span> <span class="n">es_E</span><span class="o">-&gt;</span><span class="n">initial_properties</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">initial_state</span> <span class="o">=</span> <span class="n">es_E</span><span class="o">-&gt;</span><span class="n">initial_state</span><span class="p">;</span>
    <span class="c1">// process initial properties/state
</span><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">Type</span><span class="o">::</span><span class="n">Simulate</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">sim_E</span> <span class="o">=</span> <span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">SimulatorEvent</span><span class="o">&gt;</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
    <span class="k">auto</span> <span class="n">prediction</span> <span class="o">=</span> <span class="n">sim_E</span><span class="o">-&gt;</span><span class="n">prediction</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">state</span> <span class="o">=</span> <span class="n">sim_E</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">reward</span> <span class="o">=</span> <span class="n">sim_E</span><span class="o">-&gt;</span><span class="n">reward</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">terminal</span> <span class="o">=</span> <span class="n">sim_E</span><span class="o">-&gt;</span><span class="n">terminal</span><span class="p">;</span>
    <span class="c1">// process simulator step 
</span><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">Type</span><span class="o">::</span><span class="n">Finished</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre>
<p>Event is an abstract base class for encapsulating Simulator state. Event types correspond to different
procedures in client code as shown in the table below.</p>

<table><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Episode_Start</code></td>
<td>Reset the simulator and set initial state.</td>
</tr>
<tr>
<td><code class="prettyprint">Simulate</code></td>
<td>Advance the simulation with the next prediction and record resulting state.</td>
</tr>
<tr>
<td><code class="prettyprint">Finished</code></td>
<td>Simulation complete. BRAIN does not expect further state data.</td>
</tr>
<tr>
<td><code class="prettyprint">Unknown</code></td>
<td>No event corresponding to last message exchange.</td>
</tr>
</tbody></table>

<h3 id="type-type">Type type()</h3>

<p>Returns the Type of the Event. Implemented for each specialization of Event.</p>

<h2 id="episodestartevent-class">EpisodeStartEvent Class</h2>

<p>Signals a boundary between training episodes. Requires resetting the simulation environment
and returning its initial state to the <strong>BRAIN</strong>.</p>

<h6 id="std-shared_ptr-initial_properties">std::shared_ptr<const InklingMessage> initial_properties</h6>

<p>Settings used when resetting the simulation environment.</p>

<h6 id="std-shared_ptr-initial_state">std::shared_ptr<InklingMessage> initial_state</h6>

<p>Directly manipulate to reflect the state resulting from sim environment reset.</p>

<p>See <code class="prettyprint">InklingMessage</code> header for details.</p>

<h2 id="simulateevent-class">SimulateEvent Class</h2>

<p>Signals that the <strong>BRAIN</strong> is ready to receive the simulator state resulting from
the next prediction in the queue.</p>

<h6 id="std-shared_ptr-prediction">std::shared_ptr<const InklingMessage> prediction</h6>

<p>The prediction (action) intended for the next simulation step.</p>

<h6 id="std-shared_ptr-state">std::shared_ptr<InklingMessage> state</h6>

<p>Directly manipulate to reflect the state resulting from applying <code class="prettyprint">prediction</code>
to the simulation environment.</p>

<p>See <code class="prettyprint">InklingMessage</code> header for details.</p>

<h6 id="std-shared_ptr-reward">std::shared_ptr<float> reward</h6>

<p>Directly manipulate to reflect the reward corresponding to <code class="prettyprint">state</code>.</p>

<h6 id="std-shared_ptr-terminal">std::shared_ptr<bool> terminal</h6>

<p>Directly manipulate to reflect whether the current <code class="prettyprint">state</code> is terminal.</p>

<h2 id="finishedevent-class">FinishedEvent Class</h2>

<p>Signals that the <strong>BRAIN</strong> is done training. No more simulation steps are expected.</p>

<h2 id="unknownevent-class">UnknownEvent Class</h2>

<p>Signals that no action is required.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>

    </div>

  </div>
  <!-- at the end of the BODY -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
  apiKey: '49fa6f01d7ff94a85b9b7434b1c2b7cf',
  indexName: 'bon-sai',
  inputSelector: '#docs-search',
  debug: false // Set debug to true if you want to inspect the dropdown
  });
  </script>
  </body>
</html>
